
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../FlucCD_arborescence_par_produit/">
      
      
        <link rel="next" href="../../GKE/cluster_GKE_SSL_load-balancer/">
      
      
      <link rel="icon" href="../../images/poo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>FluxCD - DÃ©monstration par l'exemple - Papa Francky's HowTos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>


  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M17%2013h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fluxcd-demonstration-par-lexemple" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Papa Francky&#39;s HowTos" class="md-header__button md-logo" aria-label="Papa Francky's HowTos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M268.9.9c-5.5-.7-11 1.4-14.5 5.7s-4.6 10.1-2.8 15.4c2.8 8.2 4.3 16.9 4.3 26.1 0 44.1-35.7 79.9-79.8 80L160 128c-35.3 0-64 28.7-64 64 0 19.1 8.4 36.3 21.7 48H104c-39.8 0-72 32.2-72 72 0 23.2 11 43.8 28 57-34.1 5.7-60 35.3-60 71 0 39.8 32.2 72 72 72h368c39.8 0 72-32.2 72-72 0-35.7-25.9-65.3-60-71 17-13.2 28-33.8 28-57 0-39.8-32.2-72-72-72h-13.7c13.3-11.7 21.7-28.9 21.7-48 0-35.3-28.7-64-64-64h-5.5c3.5-10 5.5-20.8 5.5-32 0-48.6-36.2-88.8-83.1-95.1M192 256a32 32 0 1 1 0 64 32 32 0 1 1 0-64m96 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0m64 108.3c0 2.4-.7 4.8-2.2 6.7-8.2 10.5-39.5 45-93.8 45s-85.6-34.6-93.8-45c-1.5-1.9-2.2-4.3-2.2-6.7 0-6.8 5.5-12.3 12.3-12.3h167.4c6.8 0 12.3 5.5 12.3 12.3"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Papa Francky's HowTos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FluxCD - DÃ©monstration par l'exemple
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Papa Francky&#39;s HowTos" class="md-nav__button md-logo" aria-label="Papa Francky's HowTos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M268.9.9c-5.5-.7-11 1.4-14.5 5.7s-4.6 10.1-2.8 15.4c2.8 8.2 4.3 16.9 4.3 26.1 0 44.1-35.7 79.9-79.8 80L160 128c-35.3 0-64 28.7-64 64 0 19.1 8.4 36.3 21.7 48H104c-39.8 0-72 32.2-72 72 0 23.2 11 43.8 28 57-34.1 5.7-60 35.3-60 71 0 39.8 32.2 72 72 72h368c39.8 0 72-32.2 72-72 0-35.7-25.9-65.3-60-71 17-13.2 28-33.8 28-57 0-39.8-32.2-72-72-72h-13.7c13.3-11.7 21.7-28.9 21.7-48 0-35.3-28.7-64-64-64h-5.5c3.5-10 5.5-20.8 5.5-32 0-48.6-36.2-88.8-83.1-95.1M192 256a32 32 0 1 1 0 64 32 32 0 1 1 0-64m96 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0m64 108.3c0 2.4-.7 4.8-2.2 6.7-8.2 10.5-39.5 45-93.8 45s-85.6-34.6-93.8-45c-1.5-1.9-2.2-4.3-2.2-6.7 0-6.8 5.5-12.3 12.3-12.3h167.4c6.8 0 12.3 5.5 12.3 12.3"/></svg>

    </a>
    Papa Francky's HowTos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs cheatsheet
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    000 setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            000 setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../000_setup/Command_line_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command Line Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../000_setup/Kubernetes_en_local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes en local
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/build_pull_image_on_dockerhub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CrÃ©er et publier une image sur DockerHub
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FluxCD
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            FluxCD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FlucCD_arborescence_par_produit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FluxCD - Proposition de nouvelle organisation des manifests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    FluxCD - DÃ©monstration par l'exemple
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    FluxCD - DÃ©monstration par l'exemple
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      Abstract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requis" class="md-nav__link">
    <span class="md-ellipsis">
      PrÃ©-requis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrÃ©-requis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparation-de-notre-environnement-de-travail-en-local" class="md-nav__link">
    <span class="md-ellipsis">
      PrÃ©paration de notre environnement de travail en local
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-des-depots-github" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation des dÃ©pÃ´ts GitHub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clonage-des-depots-en-local" class="md-nav__link">
    <span class="md-ellipsis">
      Clonage des dÃ©pÃ´ts en local
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bootstrap-de-fluxcd" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap de FluxCD
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-continue-avec-fluxcd" class="md-nav__link">
    <span class="md-ellipsis">
      IntÃ©gration continue avec FluxCD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntÃ©gration continue avec FluxCD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gestion-des-applications-depuis-un-depot-git" class="md-nav__link">
    <span class="md-ellipsis">
      Gestion des applications depuis un dÃ©pÃ´t Git
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des applications depuis un dÃ©pÃ´t Git">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-dedie-a-lapplication" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace dÃ©diÃ© Ã  l'application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depot-github-dedie-aux-applications" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©pÃ´t GitHub dÃ©diÃ© aux applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-micro-service-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      Le micro-service 'agnhost'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DÃ©finition du GitRepository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-la-deploy-key" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation de la 'Deploy Key'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploiement-de-la-deploy-key-sur-le-depot-github" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©ploiement de la 'Deploy Key' sur le dÃ©pÃ´t GitHub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository-k8s-kind-apps" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository "k8s-kind-apps"
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-de-la-kustomization-pour-notre-application-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition de la 'Kustomization' pour notre application 'agnhost'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatisation-de-la-mise-a-jour-des-images" class="md-nav__link">
    <span class="md-ellipsis">
      Automatisation de la mise Ã  jour des images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automatisation de la mise Ã  jour des images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imagerepository" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRepository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imagepolicy" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePolicy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reecriture-du-tag-de-limage-docker" class="md-nav__link">
    <span class="md-ellipsis">
      RÃ©Ã©criture du tag de l'image Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-update-automation" class="md-nav__link">
    <span class="md-ellipsis">
      Image Update Automation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-des-applications-depuis-un-depot-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Gestion des applications depuis un dÃ©pÃ´t Helm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des applications depuis un dÃ©pÃ´t Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-dedie-a-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace dÃ©diÃ© Ã  l'application 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-helm-chart-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le Helm Chart 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le Helm Chart &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adresse-du-helm-chart-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Adresse du Helm Chart 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentification-aupres-du-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Authentification auprÃ¨s du Helm Repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-helmrepository-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le HelmRepository 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le HelmRepository &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentification-au-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Authentification au Helm Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-helmrepository" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du HelmRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-gitrepository-pour-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le GitRepository pour l'application 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le GitRepository pour l&#39;application &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-key" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy Key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-la-deploy-key_1" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation de la 'Deploy Key'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploiement-de-la-deploy-key-sur-le-depot-github_1" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©ploiement de la 'Deploy Key' sur le dÃ©pÃ´t GitHub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository_1" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kustomization-du-gitrepository-pour-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Kustomization du GitRepository pour l'application 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-helm-release" class="md-nav__link">
    <span class="md-ellipsis">
      La Helm Release
    </span>
  </a>
  
    <nav class="md-nav" aria-label="La Helm Release">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#personnalisation-de-la-helm-release-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Personnalisation de la Helm Release 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-de-la-helmrelease" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition de la HelmRelease
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notifications-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Notifications Discord
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notifications Discord">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-et-configuration-du-client-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Installation et configuration du client 'Discord'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation et configuration du client &#39;Discord&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-du-client-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Installation du client 'Discord'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-serveur-discord" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un serveur Discord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-channel-dans-notre-serveur-discord" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un channel dans notre serveur Discord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-webhook-pour-chaque-salon" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un 'webhook' pour chaque salon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-secret-pour-chaque-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un secret pour chaque webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-des-notification-providers" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition des 'notification providers'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-des-alertes" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration des alertes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-des-alertes-et-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      Activation des alertes et notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    <span class="md-ellipsis">
      Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      Application 'agnhost'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application &#39;agnhost&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contexte" class="md-nav__link">
    <span class="md-ellipsis">
      Contexte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Application 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contexte_1" class="md-nav__link">
    <span class="md-ellipsis">
      Contexte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_1" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposition-des-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Exposition des applications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GKE
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            GKE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    cluster GKE SSL load balancer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            cluster GKE SSL load balancer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GKE/cluster_GKE_SSL_load-balancer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster GKE en mode autopilot, load-balancer HTTPS et application 'stateless'
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    cluster GKE Wordpress CloudSQL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            cluster GKE Wordpress CloudSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GKE/cluster_GKE_Wordpress_CloudSQL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy WordPress on GKE with Persistent Disk and Cloud SQL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dkt upgrade cluster gke
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Dkt upgrade cluster gke
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GKE/dkt_upgrade_cluster_gke/readme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mise Ã  jour des clusters Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    terraform GKE cluster
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            terraform GKE cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GKE/terraform_GKE_cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Minikube
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Minikube
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Minikube/minikube_nginx_controller_macos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Minikube et l'ingress Nginx sur macOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Prometheus on minikube from scratch
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Prometheus on minikube from scratch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Minikube/prometheus_on_minikube_from_scratch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus on MiniKube from scratch
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Prometheus and Grafana
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Prometheus and Grafana
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus_and_Grafana/kube-prometheus-stack_managed_with_fluxcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    'kube-prometheus-stack' managed with FluxCD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus_and_Grafana/prometheus_grafana_on_k8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus &amp; Grafana on Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vault
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Vault
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cluster minikube vault with raft storage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Cluster minikube vault with raft storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/cluster_minikube_vault_with_raft_storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster [kind|minikube] - HashiCorp Vault with Raft integrated storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Helm vault auto unseal
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Helm vault auto unseal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/helm_vault_auto-unseal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auto-unsealed Vault Helm deployment managed with FluxCD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    kind helm vault auto unseal ESO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            kind helm vault auto unseal ESO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/kind_helm_vault_auto-unseal_ESO/kind_vault_auto-unsealed_eso_fluxcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DÃ©ploiement de Vault (auto-unsealed) et ESO via FluxCD sur un cluster KinD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kind vault external secrets operator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Kind vault external secrets operator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/kind_vault_external_secrets_operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kind - Vault - External-secrets operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/kind_vault_external_secrets_operator/README.2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kind - Vault - External-secrets operator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    protect secrets using Vault and External Secrets Operator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            protect secrets using Vault and External Secrets Operator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault/protect_secrets_using_Vault_and_External_Secrets_Operator/readme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protect the secrets of your application using HashiCorp Vault and the External Secrets Operator (ESO)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      Abstract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requis" class="md-nav__link">
    <span class="md-ellipsis">
      PrÃ©-requis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrÃ©-requis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparation-de-notre-environnement-de-travail-en-local" class="md-nav__link">
    <span class="md-ellipsis">
      PrÃ©paration de notre environnement de travail en local
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-des-depots-github" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation des dÃ©pÃ´ts GitHub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clonage-des-depots-en-local" class="md-nav__link">
    <span class="md-ellipsis">
      Clonage des dÃ©pÃ´ts en local
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bootstrap-de-fluxcd" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap de FluxCD
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-continue-avec-fluxcd" class="md-nav__link">
    <span class="md-ellipsis">
      IntÃ©gration continue avec FluxCD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntÃ©gration continue avec FluxCD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gestion-des-applications-depuis-un-depot-git" class="md-nav__link">
    <span class="md-ellipsis">
      Gestion des applications depuis un dÃ©pÃ´t Git
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des applications depuis un dÃ©pÃ´t Git">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-dedie-a-lapplication" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace dÃ©diÃ© Ã  l'application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depot-github-dedie-aux-applications" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©pÃ´t GitHub dÃ©diÃ© aux applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-micro-service-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      Le micro-service 'agnhost'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DÃ©finition du GitRepository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-la-deploy-key" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation de la 'Deploy Key'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploiement-de-la-deploy-key-sur-le-depot-github" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©ploiement de la 'Deploy Key' sur le dÃ©pÃ´t GitHub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository-k8s-kind-apps" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository "k8s-kind-apps"
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-de-la-kustomization-pour-notre-application-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition de la 'Kustomization' pour notre application 'agnhost'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatisation-de-la-mise-a-jour-des-images" class="md-nav__link">
    <span class="md-ellipsis">
      Automatisation de la mise Ã  jour des images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automatisation de la mise Ã  jour des images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imagerepository" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRepository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imagepolicy" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePolicy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reecriture-du-tag-de-limage-docker" class="md-nav__link">
    <span class="md-ellipsis">
      RÃ©Ã©criture du tag de l'image Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-update-automation" class="md-nav__link">
    <span class="md-ellipsis">
      Image Update Automation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-des-applications-depuis-un-depot-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Gestion des applications depuis un dÃ©pÃ´t Helm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des applications depuis un dÃ©pÃ´t Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-dedie-a-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Namespace dÃ©diÃ© Ã  l'application 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-helm-chart-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le Helm Chart 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le Helm Chart &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adresse-du-helm-chart-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Adresse du Helm Chart 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentification-aupres-du-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Authentification auprÃ¨s du Helm Repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-helmrepository-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le HelmRepository 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le HelmRepository &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentification-au-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Authentification au Helm Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-helmrepository" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du HelmRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-gitrepository-pour-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Le GitRepository pour l'application 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le GitRepository pour l&#39;application &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-key" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy Key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-la-deploy-key_1" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation de la 'Deploy Key'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploiement-de-la-deploy-key-sur-le-depot-github_1" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©ploiement de la 'Deploy Key' sur le dÃ©pÃ´t GitHub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-du-gitrepository_1" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition du GitRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kustomization-du-gitrepository-pour-lapplication-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Kustomization du GitRepository pour l'application 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-helm-release" class="md-nav__link">
    <span class="md-ellipsis">
      La Helm Release
    </span>
  </a>
  
    <nav class="md-nav" aria-label="La Helm Release">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#personnalisation-de-la-helm-release-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Personnalisation de la Helm Release 'podinfo'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-de-la-helmrelease" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition de la HelmRelease
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notifications-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Notifications Discord
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notifications Discord">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-et-configuration-du-client-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Installation et configuration du client 'Discord'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation et configuration du client &#39;Discord&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-du-client-discord" class="md-nav__link">
    <span class="md-ellipsis">
      Installation du client 'Discord'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-serveur-discord" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un serveur Discord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-channel-dans-notre-serveur-discord" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un channel dans notre serveur Discord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-webhook-pour-chaque-salon" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un 'webhook' pour chaque salon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-secret-pour-chaque-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      CrÃ©ation d'un secret pour chaque webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition-des-notification-providers" class="md-nav__link">
    <span class="md-ellipsis">
      DÃ©finition des 'notification providers'
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-des-alertes" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration des alertes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-des-alertes-et-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      Activation des alertes et notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    <span class="md-ellipsis">
      Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-agnhost" class="md-nav__link">
    <span class="md-ellipsis">
      Application 'agnhost'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application &#39;agnhost&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contexte" class="md-nav__link">
    <span class="md-ellipsis">
      Contexte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-podinfo" class="md-nav__link">
    <span class="md-ellipsis">
      Application 'podinfo'
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application &#39;podinfo&#39;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contexte_1" class="md-nav__link">
    <span class="md-ellipsis">
      Contexte
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_1" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposition-des-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Exposition des applications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="fluxcd-demonstration-par-lexemple">FluxCD - DÃ©monstration par l'exemple</h1>
<hr />
<h2 id="abstract">Abstract</h2>
<p>Sur un cluster <em>Rancher Desktop</em> fraÃ®chement dÃ©ployÃ©, nous installerons FluxCD (ie. <em>'bootstrap'</em>) pour gÃ©rer le dÃ©ploiement et la mise Ã  jour de 2 applications trÃ¨s simples. La premiÃ¨re voit son code source hÃ©bergÃ© dans un dÃ©pÃ´t Git tandis que la seconde est packagÃ©e et mise Ã  disposition dans un dÃ©pÃ´t Helm. Nous couvrirons donc ces deux types de dÃ©ploiement.</p>
<p>Nous mettrons Ã©galement en place des notifications pour nous alerter via une messagerie instantanÃ©e (<em>Discord</em>) des Ã©volutions Ã©ventuelles de nos applications.</p>
<pre class="mermaid"><code>
graph TD

A(utilisateurs)
B((ingress controler))
C{service 'agnhost'}
D{service 'podinfor'}
E[deployment 'agnhost']
F[deployment 'podinfo']

A -.-&gt; B
B --&gt; C &amp; D

subgraph application 'agnhost'
C --&gt; E
end

subgraph application 'podinfo'
D --&gt; F
end</code></pre>
<hr />
<h2 id="pre-requis">PrÃ©-requis</h2>
<h3 id="preparation-de-notre-environnement-de-travail-en-local">PrÃ©paration de notre environnement de travail en local</h3>
<p>Nous aurons dÃ©jÃ  suivi les howtos suivant pour prÃ©parer notre environnement de travail sur notre laptop avec les CLIs et un cluster Kins opÃ©rationnel :</p>
<table>
<thead>
<tr>
<th>howto</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Command Line Tools</td>
<td><a href="https://papafrancky.github.io/000_setup/Command_line_tools/">https://papafrancky.github.io/000_setup/Command_line_tools/</a></td>
</tr>
<tr>
<td>Kubernetes en local</td>
<td><a href="https://papafrancky.github.io/000_setup/Kubernetes_en_local/">https://papafrancky.github.io/000_setup/Kubernetes_en_local/</a></td>
</tr>
</tbody>
</table>
<h3 id="creation-des-depots-github">CrÃ©ation des dÃ©pÃ´ts GitHub</h3>
<p>CommenÃ§ons par nous authentifier sur GitHub et crÃ©ons deux nouveaux dÃ©pÃ´ts privÃ©s :</p>
<table>
<thead>
<tr>
<th>DÃ©pÃ´t</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>k8s-kind-fluxcd</td>
<td>dÃ©pÃ´t GitHub dÃ©diÃ© Ã  FluxCD sur notre cluster</td>
</tr>
<tr>
<td>k8s-kind-apps</td>
<td>dÃ©pÃ´t GitHub dÃ©diÃ© Ã  l'hÃ©bergement des applications Ã  dÃ©ployer via FluxCD</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nos dÃ©pÃ´ts ont pour prÃ©fixe '<em>k8s-kind-</em>' parce que nous utilisions prÃ©alablement pour nos travaux pratiques un cluster local '<em>KinD</em>' (ie. '<a href="https://kind.sigs.k8s.io/"><em>Kubernetes in Docker</em></a>'). Nous avons depuis optÃ© pour '<em><a href="https://rancherdesktop.io/">Rancher Desktop</a></em>'.</p>
</div>
<p>CrÃ©ation du dÃ©pÃ´t GitHub dÃ©diÃ© Ã  FluxCD :
<img alt="Nouveau dÃ©pÃ´t GitHub dÃ©diÃ© Ã  FluxCD" src="../images/new_github_repository_dedicated_to_fluxcd.png" /></p>
<p>CrÃ©ation du dÃ©pÃ´t GitHub dÃ©diÃ© aux applications :
<img alt="Nouveau dÃ©pÃ´t GitHub dÃ©diÃ© aux applications" src="../images/new_github_repository_dedicated_to_apps.png" /></p>
<h3 id="clonage-des-depots-en-local">Clonage des dÃ©pÃ´ts en local</h3>
<p>Une fois les dÃ©pÃ´ts crÃ©Ã©s, nous les clonons sur notre laptop :</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nous clonerons tous nos dÃ©pÃ´ts dans le rÃ©pertoire renseignÃ© dans la variable <strong>${LOCAL_GITHUB_REPOS}</strong>.</p>
</div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:papafrancky/k8s-kind-fluxcd.git
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:papafrancky/k8s-kind-apps.git
</span></code></pre></div>
<hr />
<h2 id="bootstrap-de-fluxcd">Bootstrap de FluxCD</h2>
<p>Le projet Flux est composÃ© d'un outil en ligne de commande (le Flux CLI) et d'une sÃ©rie de contrÃ´leurs Kubernetes.</p>
<p>Pour installer FluxCD, vous devez d'abord tÃ©lÃ©charger le CLI de Flux. Ensuite, Ã  l'aide de la CLI, vous pouvez dÃ©ployer les contrÃ´leurs Flux sur vos clusters et configurer votre premier pipeline de livraison GitOps.</p>
<p>La commande <em>'flux bootstrap github'</em> dÃ©ploie les contrÃ´leurs Flux sur un cluster Kubernetes et configure ces derniers pour synchroniser l'Ã©tat du cluster Ã  partir d'un dÃ©pÃ´t GitHub. En plus d'installer les contrÃ´leurs, la commande bootstrap pousse les manifestes de Flux vers le dÃ©pÃ´t GitHub et configure Flux pour qu'il se mette Ã  jour Ã  partir de Git.</p>
<table>
<thead>
<tr>
<th>Doc</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Install the Flux controllers</td>
<td><a href="https://fluxcd.io/flux/installation/#install-the-flux-controllers">https://fluxcd.io/flux/installation/#install-the-flux-controllers</a></td>
</tr>
<tr>
<td>Flux bootstrap for GitHub</td>
<td><a href="https://fluxcd.io/flux/installation/bootstrap/github/">https://fluxcd.io/flux/installation/bootstrap/github/</a></td>
</tr>
<tr>
<td>GitHub default environment variables</td>
<td><a href="https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables">https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables</a></td>
</tr>
</tbody>
</table>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">code</label><label for="__tabbed_1_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>papaFrancky
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;my_github_personal_access_token&gt;
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FLUXCD_GITHUB_REPO</span><span class="o">=</span>k8s-kind-fluxcd
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>flux<span class="w"> </span>bootstrap<span class="w"> </span>github<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span>--token-auth<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span>--owner<span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span>--repository<span class="w"> </span><span class="si">${</span><span class="nv">FLUXCD_GITHUB_REPO</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span>--branch<span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span>--path<span class="o">=</span>.<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span>--personal<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span>--components-extra<span class="o">=</span>image-reflector-controller,image-automation-controller
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>âº<span class="w"> </span>connecting<span class="w"> </span>to<span class="w"> </span>github.com
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>âº<span class="w"> </span>cloning<span class="w"> </span>branch<span class="w"> </span><span class="s2">&quot;main&quot;</span><span class="w"> </span>from<span class="w"> </span>Git<span class="w"> </span>repository<span class="w"> </span><span class="s2">&quot;https://github.com/papaFrancky/k8s-kind-fluxcd.git&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>â<span class="w"> </span>cloned<span class="w"> </span>repository
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>âº<span class="w"> </span>generating<span class="w"> </span>component<span class="w"> </span>manifests
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>â<span class="w"> </span>generated<span class="w"> </span>component<span class="w"> </span>manifests
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>â<span class="w"> </span>component<span class="w"> </span>manifests<span class="w"> </span>are<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>âº<span class="w"> </span>installing<span class="w"> </span>components<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;flux-system&quot;</span><span class="w"> </span>namespace
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>â<span class="w"> </span>installed<span class="w"> </span>components
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>â<span class="w"> </span>reconciled<span class="w"> </span>components
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>âº<span class="w"> </span>determining<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>secret<span class="w"> </span><span class="s2">&quot;flux-system/flux-system&quot;</span><span class="w"> </span>exists
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>âº<span class="w"> </span>generating<span class="w"> </span><span class="nb">source</span><span class="w"> </span>secret
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>âº<span class="w"> </span>applying<span class="w"> </span><span class="nb">source</span><span class="w"> </span>secret<span class="w"> </span><span class="s2">&quot;flux-system/flux-system&quot;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>â<span class="w"> </span>reconciled<span class="w"> </span><span class="nb">source</span><span class="w"> </span>secret
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>âº<span class="w"> </span>generating<span class="w"> </span>sync<span class="w"> </span>manifests
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>â<span class="w"> </span>generated<span class="w"> </span>sync<span class="w"> </span>manifests
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>â<span class="w"> </span>sync<span class="w"> </span>manifests<span class="w"> </span>are<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>âº<span class="w"> </span>applying<span class="w"> </span>sync<span class="w"> </span>manifests
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>â<span class="w"> </span>reconciled<span class="w"> </span>sync<span class="w"> </span>configuration
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>â<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>Kustomization<span class="w"> </span><span class="s2">&quot;flux-system/flux-system&quot;</span><span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>reconciled
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>â<span class="w"> </span>Kustomization<span class="w"> </span>reconciled<span class="w"> </span>successfully
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>âº<span class="w"> </span>confirming<span class="w"> </span>components<span class="w"> </span>are<span class="w"> </span>healthy
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>â<span class="w"> </span>helm-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>â<span class="w"> </span>image-automation-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>â<span class="w"> </span>image-reflector-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>â<span class="w"> </span>kustomize-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>â<span class="w"> </span>notification-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>â<span class="w"> </span>source-controller:<span class="w"> </span>deployment<span class="w"> </span>ready
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>â<span class="w"> </span>all<span class="w"> </span>components<span class="w"> </span>are<span class="w"> </span>healthy
</span></code></pre></div>
</div>
</div>
</div>
<p>VÃ©rifions dans les Ã©vÃ©nements de FluxCD :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">code</label><label for="__tabbed_2_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>flux<span class="w"> </span>events
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>LAST<span class="w"> </span>SEEN<span class="w">          </span>TYPE<span class="w">    </span>REASON<span class="w">                  </span>OBJECT<span class="w">                          </span>MESSAGE
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>15m<span class="w">                     </span>Normal<span class="w">  </span>NewArtifact<span class="w">             </span>GitRepository/flux-system<span class="w">       </span>stored<span class="w"> </span>artifact<span class="w"> </span><span class="k">for</span><span class="w"> </span>commit<span class="w"> </span><span class="s1">&#39;Add Flux sync manifests&#39;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>15m<span class="w">                     </span>Normal<span class="w">  </span>ReconciliationSucceeded<span class="w"> </span>Kustomization/flux-system<span class="w">       </span>Reconciliation<span class="w"> </span>finished<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.536346081s,<span class="w"> </span>next<span class="w"> </span>run<span class="w"> </span><span class="k">in</span><span class="w"> </span>10m0s
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>15m<span class="w">                     </span>Normal<span class="w">  </span>Progressing<span class="w">             </span>Kustomization/flux-system<span class="w">       </span>CustomResourceDefinition/alerts.notification.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">                                                                                        </span>CustomResourceDefinition/buckets.source.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">                                                                                        </span>CustomResourceDefinition/gitrepositories.source.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">                                                                                        </span>CustomResourceDefinition/helmcharts.source.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">                                                                                        </span>CustomResourceDefinition/helmreleases.helm.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">                                                                                        </span>CustomResourceDefinition/helmrepositories.source.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">                                                                                        </span>CustomResourceDefinition/imagepolicies.image.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">                                                                                        </span>CustomResourceDefinition/imagerepositories.image.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">                                                                                        </span>CustomResourceDefinition/imageupdateautomations.image.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">                                                                                        </span>CustomResourceDefinition/kustomizations.kustomize.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">                                                                                        </span>CustomResourceDefinition/ocirepositories.source.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">                                                                                        </span>CustomResourceDefinition/providers.notification.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">                                                                                        </span>CustomResourceDefinition/receivers.notification.toolkit.fluxcd.io<span class="w"> </span>configured
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">                                                                                        </span>Namespace/flux-system<span class="w"> </span>configured
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/helm-controller<span class="w"> </span>configured
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/image-automation-controller<span class="w"> </span>configured
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/image-reflector-controller<span class="w"> </span>configured
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/kustomize-controller<span class="w"> </span>configured
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/notification-controller<span class="w"> </span>configured
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">                                                                                        </span>ServiceAccount/flux-system/source-controller<span class="w"> </span>configured
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">                                                                                        </span>ClusterRole/crd-controller-flux-system<span class="w"> </span>configured
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">                                                                                        </span>ClusterRole/flux-edit-flux-system<span class="w"> </span>configured
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">                                                                                        </span>ClusterRole/flux-view-flux-system<span class="w"> </span>configured
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">                                                                                        </span>ClusterRoleBinding/cluster-reconciler-flux-system<span class="w"> </span>configured
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">                                                                                        </span>ClusterRoleBinding/crd-controller-flux-system<span class="w"> </span>configured
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">                                                                                        </span>Service/flux-system/notification-controller<span class="w"> </span>configured
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">                                                                                        </span>Service/flux-system/source-controller<span class="w"> </span>configured
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">                                                                                        </span>Service/flux-system/webhook-receiver<span class="w"> </span>configured
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">                                                                                        </span>Deployment/flux-system/helm-controller<span class="w"> </span>configured
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">                                                                                        </span>Deployment/flux-system/image-automation-controller<span class="w"> </span>configured
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">                                                                                        </span>Deployment/flux-system/image-reflector-controller<span class="w"> </span>configured
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">                                                                                        </span>Deployment/flux-system/kustomize-controller<span class="w"> </span>configured
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">                                                                                        </span>Deployment/flux-system/notification-controller<span class="w"> </span>configured
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">                                                                                        </span>Deployment/flux-system/source-controller<span class="w"> </span>configured
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">                                                                                        </span>Kustomization/flux-system/flux-system<span class="w"> </span>configured
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">                                                                                        </span>NetworkPolicy/flux-system/allow-egress<span class="w"> </span>configured
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">                                                                                        </span>NetworkPolicy/flux-system/allow-scraping<span class="w"> </span>configured
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">                                                                                        </span>NetworkPolicy/flux-system/allow-webhooks<span class="w"> </span>configured
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">                                                                                        </span>GitRepository/flux-system/flux-system<span class="w"> </span>configured
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>5m29s<span class="w">                   </span>Normal<span class="w">  </span>ReconciliationSucceeded<span class="w"> </span>Kustomization/flux-system<span class="w">       </span>Reconciliation<span class="w"> </span>finished<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">761</span>.801712ms,<span class="w"> </span>next<span class="w"> </span>run<span class="w"> </span><span class="k">in</span><span class="w"> </span>10m0s
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>22s<span class="w"> </span><span class="o">(</span>x15<span class="w"> </span>over<span class="w"> </span>14m<span class="o">)</span><span class="w">      </span>Normal<span class="w">  </span>GitOperationSucceeded<span class="w">   </span>GitRepository/flux-system<span class="w">       </span>no<span class="w"> </span>changes<span class="w"> </span>since<span class="w"> </span>last<span class="w"> </span>reconcilation:<span class="w"> </span>observed<span class="w"> </span>revision<span class="w"> </span><span class="s1">&#39;main@sha1:1258fc09abf6cd1bd639cd18ce4a2e9e4c1a7a9b&#39;</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Notre dÃ©pÃ´t GitHub doit Ã©galement avoir Ã©voluÃ©. Mettons notre copie locale Ã  jour pour nous en assurer :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">code</label><label for="__tabbed_3_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>git<span class="w"> </span>pull
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>tree
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>.
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>âââ<span class="w"> </span>flux-system
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>âââ<span class="w"> </span>gotk-components.yaml
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span>âââ<span class="w"> </span>gotk-sync.yaml
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span>âââ<span class="w"> </span>kustomization.yaml
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="m">2</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">3</span><span class="w"> </span>files
</span></code></pre></div>
</div>
</div>
</div>
<p>Listons les objets crÃ©es sur notre cluster (dans le namespace <em>flux-system</em>) :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">code</label><label for="__tabbed_4_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>flux-system<span class="w"> </span>get<span class="w"> </span>all
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>NAME<span class="w">                                               </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>pod/helm-controller-57694fc9d6-pbl5c<span class="w">               </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>pod/image-automation-controller-5f7d999559-49fms<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>pod/image-reflector-controller-58db7c9785-mjfh5<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>pod/kustomize-controller-7f689848b9-k7hmd<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>pod/notification-controller-6cffcffd7d-rkmwl<span class="w">       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>pod/source-controller-7f95c446b6-b8gcd<span class="w">             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>19m
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>NAME<span class="w">                              </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">     </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">   </span>AGE
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>service/notification-controller<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.96.206.29<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>/TCP<span class="w">    </span>19m
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>service/source-controller<span class="w">         </span>ClusterIP<span class="w">   </span><span class="m">10</span>.96.94.126<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>/TCP<span class="w">    </span>19m
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>service/webhook-receiver<span class="w">          </span>ClusterIP<span class="w">   </span><span class="m">10</span>.96.125.18<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>/TCP<span class="w">    </span>19m
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>NAME<span class="w">                                          </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>deployment.apps/helm-controller<span class="w">               </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>deployment.apps/image-automation-controller<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>deployment.apps/image-reflector-controller<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>deployment.apps/kustomize-controller<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>deployment.apps/notification-controller<span class="w">       </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>deployment.apps/source-controller<span class="w">             </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>19m
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>NAME<span class="w">                                                     </span>DESIRED<span class="w">   </span>CURRENT<span class="w">   </span>READY<span class="w">   </span>AGE
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>replicaset.apps/helm-controller-57694fc9d6<span class="w">               </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>replicaset.apps/image-automation-controller-5f7d999559<span class="w">   </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>replicaset.apps/image-reflector-controller-58db7c9785<span class="w">    </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>replicaset.apps/kustomize-controller-7f689848b9<span class="w">          </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>replicaset.apps/notification-controller-6cffcffd7d<span class="w">       </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>replicaset.apps/source-controller-7f95c446b6<span class="w">             </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">       </span>19m
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h2 id="integration-continue-avec-fluxcd">IntÃ©gration continue avec FluxCD</h2>
<p>FluxCD peut gÃ©rer l'automatisation des dÃ©ploiements d'applications packagÃ©es avec Helm ou bien directement depuis un dÃ©pÃ´t Git. Nous allons d'abord nous concentrer sur le dÃ©ploiement d'applications depuis un dÃ©pÃ´t Git (GitHub dans notre cas).</p>
<p>Les objets de FluxCD sont un peu comme des poupÃ©es Russes, il est important de garder en tÃªte leurs interdÃ©pendances pour comprendre l'ordre dans lequel nous devrons les crÃ©er.</p>
<pre class="mermaid"><code>graph RL

ImagePolicy("Image Policy")
ImageRepository("Image Repository")
ImageRegistry("Docker image registry")
Deployment("Deployment")
ImageUpdateAutomation("Image Update Automation")
GithubRepository("GitHub Repository")
Kustomization("Kustomization")
GitRepository("Git Repository")
DeployKeys("(secret) deploy keys")
HelmRelease("Helm Release")
HelmRepository("Helm Repository")
helmrepository("Helm Registry")
Alert("Alert")
Provider("Provider")
InstantMessaging("Discord Instant Messaging")
Webhook("(secret) Discord Webhook")

classDef FluxCDObject fill:olivedrab,stroke:darkolivegreen,stroke-width:3px;
class ImagePolicy,ImageRepository,ImageUpdateAutomation,Kustomization,GitRepository,HelmRelease,HelmRepository,Alert,Provider FluxCDObject

ImageRegistry ----&gt; ImageRepository
ImageRegistry --&gt; Deployment
ImageRepository --&gt; ImagePolicy
Deployment --&gt; GithubRepository
GithubRepository --&gt; ImageUpdateAutomation &amp; GitRepository
DeployKeys --&gt; GitRepository
GitRepository --&gt; Kustomization

HelmRepository --&gt; HelmRelease
helmrepository ----&gt; HelmRepository

InstantMessaging &amp; Webhook ----&gt; Provider
Provider --&gt; Alert</code></pre>
<h3 id="gestion-des-applications-depuis-un-depot-git">Gestion des applications depuis un dÃ©pÃ´t Git</h3>
<h4 id="namespace-dedie-a-lapplication">Namespace dÃ©diÃ© Ã  l'application</h4>
<p>Pour illustrer l'intÃ©gration continue d'une application dont le code source est hÃ©bergÃ© dans un dÃ©pÃ´t Git, nous prendrons une application simple : '<em>agnhost</em>'.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://pkg.go.dev/k8s.io/kubernetes/test/images/agnhost#section-readme">Informations sur l'application '<em>agnhost</em>'</a></p>
</div>
<p>L'application sera exÃ©cutÃ©e dans un namespace Ã©ponyme dÃ©diÃ© que nous devons crÃ©er. Le manifest YAML de crÃ©ation du namespace sera placÃ© dans le dÃ©pÃ´t GitHub dÃ©diÃ© Ã  FluxCD.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nous allons demander Ã  FluxCD de crÃ©er ce namespace tout de suite car nous devrons vite y rattacher de nouveaux objets en lien avec l'application. Si le namespace n'existe pas, nous ne pourrons tout simplement pas les crÃ©er.</p>
</div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>apps/agnhost
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>agnhost<span class="w"> </span>--dry-run<span class="o">=</span>client<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/agnhost.namespace.yaml
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Creating agnhost namespace.&#39;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>git<span class="w"> </span>push
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>VÃ©rifions la crÃ©ation du namespace :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">code</label><label for="__tabbed_5_2">namespace 'agnhost'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>agnhost
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>NAME<span class="w">      </span>STATUS<span class="w">   </span>AGE
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>agnhost<span class="w">   </span>Active<span class="w">   </span>12s
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="depot-github-dedie-aux-applications">DÃ©pÃ´t GitHub dÃ©diÃ© aux applications</h4>
<p>Nous dÃ©cidons ici d'hÃ©berger toutes nos applications dans un seul dÃ©pÃ´t GitHub (mais nous aurions trÃ¨s bien pu dÃ©cider que chaque application disposait d'un dÃ©pÃ´t GitHub qui serait dÃ©diÃ©) : <code>github.com/${GITHUB_USERNAME}/k8s-kind-apps</code>.</p>
<h4 id="le-micro-service-agnhost">Le micro-service '<em>agnhost</em>'</h4>
<p>Plus haut, nous avons montrÃ© comment le dÃ©finir sur la plate-forme GitHub, puis comment crÃ©er une copie de ce dernier en local avec la commande <code>git clone</code>.</p>
<p>Dans cette copie locale, nous allons dÃ©finir le micro-service '<em>agnhost</em>' composÃ© d'un '<em>deployment</em>' et d'un '<em>service</em>' :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">code</label><label for="__tabbed_6_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>mkdir<span class="w"> </span>agnhost
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1"># deployment :</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt; agnhost/agnhost.deployment.yaml</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="s">apiVersion: apps/v1</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="s">kind: Deployment</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="s">metadata:</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="s">  labels:</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="s">    app: agnhost</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="s">  name: agnhost</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="s">  namespace: agnhost</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="s">spec:</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="s">  replicas: 1</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="s">  selector:</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="s">    matchLabels:</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="s">      app: agnhost</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="s">  template:</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="s">    metadata:</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="s">      labels:</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="s">        app: agnhost</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="s">    spec:</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="s">      containers:</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="s">      - name: agnhost</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="s">        image: registry.k8s.io/e2e-test-images/agnhost:2.39</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="s">        command:</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="s">        - /agnhost</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="s">        - netexec</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="s">        - --http-port</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="s">        - &quot;8080&quot;</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="s">EOF</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="c1"># service : </span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt; agnhost/agnhost.service.yaml</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="s">---</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="s">kind: Service</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="s">apiVersion: v1</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="s">metadata:</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="s">  name: agnhost</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="s">  namespace: agnhost</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="s">spec:</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="s">  selector:</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="s">    app: agnhost</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="s">  ports:</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="s">  # Default port used by the image</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="s">  - port: 8080</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="s">EOF</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="c1"># Arborescence des fichiers gÃ©nÃ©rÃ©s :</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>tree
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>.
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>âââ<span class="w"> </span>agnhost
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span>âââ<span class="w"> </span>agnhost.deployment.yaml
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span>âââ<span class="w"> </span>agnhost.service.yaml
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="m">2</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">2</span><span class="w"> </span>files
</span></code></pre></div>
</div>
</div>
</div>
<p>Poussons nos dÃ©finitions sur le dÃ©pÃ´t GitHub :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Added agnhost application manifests.&#39;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>git<span class="w"> </span>push
</span></code></pre></div>
<h4 id="definition-du-gitrepository">DÃ©finition du GitRepository</h4>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/components/source/gitrepositories/">https://fluxcd.io/flux/components/source/gitrepositories/</a></p>
</div>
<p>Nous allons dÃ©finir au niveau de FluxCD le dÃ©pÃ´t GitHub qui hÃ©bergera nos applications et lui permettre de s'y connecter avec des droits d'Ã©criture : <code>k8s-kind-apps</code>.</p>
<h5 id="deploy-keys">Deploy Keys</h5>
<p>Pour permettre Ã  FluxCD de se connecter au dÃ©pÃ´t GitHub des applications dont il doit gÃ©rer l'intÃ©gration continue, nous devons crÃ©er une paire de clÃ©s SSH et dÃ©ployer la clÃ© publique sur les dÃ©pÃ´ts concernÃ©s.</p>
<p>Nous avons besoin de dÃ©finir les '<em>deploy keys</em>' avant de pouvoir dÃ©finir un '<em>GitRepository</em>'.</p>
<p>S'agissant de '<em>secrets</em>', nous ne conserverons pas le manifest YAML un le dÃ©pÃ´t GitHub. La solution idÃ©ale serait d'utiliser un coffre (ou '<em>vault</em>') pour gÃ©rer les '<em>secrets</em>' en toute sÃ©curitÃ©, sujet que nous couvrirons dans un autre HOWTO.</p>
<h6 id="creation-de-la-deploy-key">CrÃ©ation de la <em>'Deploy Key'</em></h6>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>flux<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>git<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span>--url<span class="o">=</span>ssh://github.com/<span class="si">${</span><span class="nv">GITHUB_USERNAME</span><span class="si">}</span>/k8s-kind-apps<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost
</span></code></pre></div>
<p>VÃ©rifions la bonne crÃ©ation de la '<em>deploy key</em>' pour de dÃ©pÃ´t des applications :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">code</label><label for="__tabbed_7_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>NAME<span class="w">                                     </span>TYPE<span class="w">     </span>DATA<span class="w">   </span>AGE
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>k8s-kind-apps-gitrepository-deploykeys<span class="w">   </span>Opaque<span class="w">   </span><span class="m">3</span><span class="w">      </span>35s
</span></code></pre></div>
</div>
</div>
</div>
<p>De ce '<em>secret</em>' qui contient un jeu de clÃ©s privÃ©e et publique, nous devons extraire la clÃ© publique pour la renseigner sur notre dÃ©pÃ´t GitHub :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">code</label><label for="__tabbed_8_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.identity\.pub}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-D
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ecdsa-sha2-nistp384<span class="w"> </span>AAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzODQAAABhBN8q8Xb3gUEQkhoLmYDlAnYdom1GBC+mJ//OH1r4OJvYszU0zBhq2+Xa9P3O6CywbRYIaP8yCtO+NBpZGx8ZDPP1WfgPDs5BPjLVE6Q+HNskPsx4sNHkM3SIc/BcFnzMUw<span class="o">==</span>
</span></code></pre></div>
</div>
</div>
</div>
<h6 id="deploiement-de-la-deploy-key-sur-le-depot-github">DÃ©ploiement de la '<em>Deploy Key</em>' sur le dÃ©pÃ´t GitHub</h6>
<p>Une fois sur la page de dÃ©pÃ´t, cliquer sur le bouton <em><em>Settings</em></em>, puis dans la colonne de gauche sur la page suivante, sur le line <em><em>Deploy Keys</em></em> dans la partie 'Security' :</p>
<p><img alt="AccÃ©der aux settings sur le dÃ©pÃ´t GitHub" src="../images/github_settings.png" /></p>
<p><img alt="AccÃ©der aux Deploy Keys sur le dÃ©pÃ´t GitHub" src="../images/github_deploykeys.png" /></p>
<p><img alt="Ajouter une nouvelle Deploy Key" src="../images/github_add_deploykey.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>La case <strong>'Allow write access'</strong> doit Ãªtre cochÃ©e pour permettre Ã  FluxCD d'apporter des modifications dans le dÃ©pÃ´t !</p>
</div>
<p><img alt="DÃ©clarer la Deploy Key 'agnhost'" src="../images/github_add_agnhost_public_key.png" /></p>
<p><img alt="Liste des 'Deploy Keys'" src="../images/github_deploy_keys_list.png" /></p>
<h5 id="definition-du-gitrepository-k8s-kind-apps">DÃ©finition du GitRepository <em>"k8s-kind-apps"</em></h5>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/components/source/gitrepositories/">https://fluxcd.io/flux/components/source/gitrepositories/</a></p>
</div>
<p>Voici les informations qu'il faudra donner pour dÃ©finir un 'GitRepository' :</p>
<ul>
<li>Le nom que nous souhaitons lui donner : <em>k8s-kind-apps</em>;</li>
<li>L'URL du dÃ©pÃ´t GitHub : <em>ssh://git@github.com/${GITHUB_USERNAME}/k8s-kind-apps.git</em>;</li>
<li>La branche du dÃ©pÃ´t d'oÃ¹ rÃ©cupÃ©rer le code : <em>main</em>;</li>
<li>Le secret d'oÃ¹ extraire la clÃ© privÃ©e pour se connecter au dÃ©pÃ´t GitHub : <em>k8s-kind-apps-gitrepository-deploykeys</em>.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">code</label><label for="__tabbed_9_2">'k8s-kind-apps' GitRepository</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>flux<span class="w"> </span>create<span class="w"> </span><span class="nb">source</span><span class="w"> </span>git<span class="w"> </span>k8s-kind-apps<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span>--url<span class="o">=</span>ssh://git@github.com/<span class="si">${</span><span class="nv">GITHUB_USERNAME</span><span class="si">}</span>/k8s-kind-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span>--branch<span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">  </span>--secret-ref<span class="o">=</span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/k8s-kind-apps.gitrepository.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>---
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>apiVersion:<span class="w"> </span>source.toolkit.fluxcd.io/v1
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>kind:<span class="w"> </span>GitRepository
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>metadata:
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span>name:<span class="w"> </span>k8s-kind-apps
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>spec:
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">  </span>ref:
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span>branch:<span class="w"> </span>main
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">  </span>secretRef:
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span>name:<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">  </span>url:<span class="w"> </span>ssh://git@github.com/papafrancky/k8s-kind-apps.git
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="definition-de-la-kustomization-pour-notre-application-agnhost">DÃ©finition de la <em>'Kustomization'</em> pour notre application '<em>agnhost</em>'</h4>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p>https://fluxcd.io/flux/cmd/flux_create_kustomization/
https://fluxcd.io/flux/components/kustomize/kustomizations/</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Nommer le manifest 'kustomize.yml' pose des problÃ¨mes, le nom doit Ãªtre rÃ©servÃ© pour les besoins internes de Flux. Nous le nommerons 'sync.yaml'.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">code</label><label for="__tabbed_10_2">kustomization 'agnhost'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>flux<span class="w"> </span>create<span class="w"> </span>kustomization<span class="w"> </span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span>--source<span class="o">=</span>GitRepository/k8s-kind-apps.agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span>--path<span class="o">=</span>./agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span>--prune<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span>--export<span class="w">  </span>&gt;<span class="w"> </span>apps/agnhost/agnhost.kustomization.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>---
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>apiVersion:<span class="w"> </span>kustomize.toolkit.fluxcd.io/v1
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>kind:<span class="w"> </span>Kustomization
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>metadata:
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span>name:<span class="w"> </span>agnhost
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>spec:
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span>path:<span class="w"> </span>./agnhost
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span>prune:<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span>sourceRef:
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span>kind:<span class="w"> </span>GitRepository
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span>name:<span class="w"> </span>k8s-kind-apps
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span>namespace:<span class="w"> </span>agnhost
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nous pourrions ne dÃ©finir qu'une '<em>kustomization</em>' pour l'ensemble du dÃ©pÃ´t GitHub dÃ©diÃ© aux applications. Nous privilÃ©gions ici une approche plus atomique en crÃ©ant une '<em>kustomization</em>' pour chaque application.</p>
</div>
<p>Il est temps de pousser nos modifications dans le dÃ©pÃ´t GitHub :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>git<span class="w"> </span>status
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: added GitRepository and Kustomization for &#39;agnhost&#39; app.&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>git<span class="w"> </span>push
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>ForÃ§ons la rÃ©conciliation :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>flux<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>agnhost<span class="w"> </span>--with-source
</span></code></pre></div>
<p>Nous devrions dÃ©sormais voir le GitRepository dÃ©fini au niveau du cluster :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">code</label><label for="__tabbed_11_2">output </label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>kubectl -n agnhost get gitrepository k8s-kind-apps
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>NAME            URL                                                  AGE   READY   STATUS
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>k8s-kind-apps   ssh://git@github.com/papafrancky/k8s-kind-apps.git   36s   True    stored artifact for revision &#39;main@sha1:fe6dda52ecf1c3d031aea013e1b9f4a2ed8fba9c&#39;
</span></code></pre></div>
</div>
</div>
</div>
<p>Surtout, nous devrions voir notre application '<em>agnhost</em>' Ã©ployÃ©e sur le cluster :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">code</label><label for="__tabbed_12_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>deployments,services,pods
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>NAME<span class="w">                      </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>deployment.apps/agnhost<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>1m20s
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>NAME<span class="w">              </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">    </span>AGE
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>service/agnhost<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.43.179.127<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">8080</span>/TCP<span class="w">   </span>1m20s
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>NAME<span class="w">                           </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>pod/agnhost-597fb984fd-brr4d<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>1m21s
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="automatisation-de-la-mise-a-jour-des-images">Automatisation de la mise Ã  jour des images</h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://pkg.go.dev/k8s.io/kubernetes/test/images/agnhost#section-readme">https://pkg.go.dev/k8s.io/kubernetes/test/images/agnhost#section-readme</a></p>
</div>
<p>Notre application est conteneurisÃ©e et utilise par consÃ©quent une image Docker : <code>e2e-test-images/agnhost:2.39</code>.</p>
<p>Nous souhaiterions que Flux la mette Ã  jour automatiquement si une nouvelle image venait Ã  Ãªtre publiÃ©e.
La mise en place d'un tel process d'automatisation nÃ©cessite la dÃ©finition prÃ©alable d'un <strong>'ImageRepository'</strong> auquel nous associerons une <strong>'ImagePolicy'</strong>.</p>
<h5 id="imagerepository">ImageRepository</h5>
<p>Comme son nom l'indique, cet objet dÃ©finit un dÃ©pÃ´t d'images Docker.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>flux<span class="w"> </span>create<span class="w"> </span>image<span class="w"> </span>repository<span class="w"> </span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span>--image<span class="o">=</span>registry.k8s.io/e2e-test-images/agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">  </span>--interval<span class="o">=</span>5m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/agnhost.imagerepository.yaml
</span></code></pre></div>
</div>
</div>
</div>
<h5 id="imagepolicy">ImagePolicy</h5>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/components/image/imagepolicies/#policy">https://fluxcd.io/flux/components/image/imagepolicies/#policy</a></p>
<p><a href="https://github.com/Masterminds/semver#checking-version-constraints">https://github.com/Masterminds/semver#checking-version-constraints</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Les images dans le dÃ©pÃ´t ne sont suivent pas le versionnement 'SemVer'. Nous devons ici choisir une <em>policy</em> de type <em>numerical</em> (autres choix possibles: semver et alphabetical) et trier les tags de l'image <em>agnhost</em> par ordre croissant pour arriver Ã  nos fins.</p>
</div>
<p>Une '<em>image policy</em>' dicter la rÃ¨gle de sÃ©lection l'image, comme par exemple l'image la plus rÃ©cente, ou la derniÃ¨re image Ã  une version majeure donnÃ©es, etc...</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/cmd/flux_create_image_policy/">https://fluxcd.io/flux/cmd/flux_create_image_policy/</a></p>
</div>
<p>Dans cet exemple, nous dÃ©cidons de mettre Ã  jour notre application Ã  sa version la plus ancienne. Bien Ã©videmment, en rÃ©alitÃ© cela n'a pas de sens car nous attendons de l'intÃ©gration continue que nos applications restent le plus Ã  jour. Mais nous le faisons volontairement car nous mettrons bientot du monitoring en place et validerons son bon fonctionnement en corrigeant notre '<em>ImagePolicy</em>'.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>flux<span class="w"> </span>create<span class="w"> </span>image<span class="w"> </span>policy<span class="w"> </span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span>--image-ref<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">  </span>--select-numeric<span class="o">=</span>desc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">  </span>--filter-regex<span class="o">=</span><span class="s1">&#39;\d\.\d\d&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/agnhost.imagepolicy.yaml
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: defined an image repository and image policy for the agnhost application.&quot;</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>git<span class="w"> </span>push
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>VÃ©rifions la bonne crÃ©ation de l'<em>Image Repository</em> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">code</label><label for="__tabbed_14_2">Image Repository 'agnhost'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>imagerepository<span class="w"> </span>agnhost<span class="w"> </span>-o<span class="w"> </span>yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>items:
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>-<span class="w"> </span>apiVersion:<span class="w"> </span>image.toolkit.fluxcd.io/v1beta2
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span>kind:<span class="w"> </span>ImageRepository
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span>metadata:
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-10-02T19:57:16Z&quot;</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">    </span>finalizers:
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span>-<span class="w"> </span>finalizers.fluxcd.io
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span>generation:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span>labels:
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">      </span>kustomize.toolkit.fluxcd.io/name:<span class="w"> </span>flux-system
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">      </span>kustomize.toolkit.fluxcd.io/namespace:<span class="w"> </span>flux-system
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span>name:<span class="w"> </span>agnhost
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">    </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">    </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;328135&quot;</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">    </span>uid:<span class="w"> </span>8f3b17ff-4c2c-4360-8e5b-53b7e3c9455a
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">  </span>spec:
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">    </span>exclusionList:
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">    </span>-<span class="w"> </span>^.*<span class="se">\.</span>sig$
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">    </span>image:<span class="w"> </span>registry.k8s.io/e2e-test-images/agnhost
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">    </span>interval:<span class="w"> </span>5m0s
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">    </span>provider:<span class="w"> </span>generic
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">  </span>status:
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w">    </span>canonicalImageName:<span class="w"> </span>registry.k8s.io/e2e-test-images/agnhost
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">    </span>conditions:
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="w">    </span>-<span class="w"> </span>lastTransitionTime:<span class="w"> </span><span class="s2">&quot;2025-10-02T19:57:17Z&quot;</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">      </span>message:<span class="w"> </span><span class="s1">&#39;successful scan: found 33 tags&#39;</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">      </span>observedGeneration:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">      </span>reason:<span class="w"> </span>Succeeded
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w">      </span>status:<span class="w"> </span><span class="s2">&quot;True&quot;</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="w">      </span>type:<span class="w"> </span>Ready
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w">    </span>lastScanResult:
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="w">      </span>latestTags:
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.9&quot;</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.57&quot;</span>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.56&quot;</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.55&quot;</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.54&quot;</span>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.53&quot;</span>
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.52&quot;</span>
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.51&quot;</span>
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.50&quot;</span>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a><span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;2.48&quot;</span>
</span><span id="__span-33-44"><a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a><span class="w">      </span>scanTime:<span class="w"> </span><span class="s2">&quot;2025-10-02T19:57:17Z&quot;</span>
</span><span id="__span-33-45"><a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="w">      </span>tagCount:<span class="w"> </span><span class="m">33</span>
</span><span id="__span-33-46"><a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a><span class="w">    </span>observedExclusionList:
</span><span id="__span-33-47"><a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a><span class="w">    </span>-<span class="w"> </span>^.*<span class="se">\.</span>sig$
</span><span id="__span-33-48"><a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a><span class="w">    </span>observedGeneration:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-33-49"><a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a>kind:<span class="w"> </span>List
</span><span id="__span-33-50"><a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a>metadata:
</span><span id="__span-33-51"><a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a><span class="w">  </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous constatons que le dÃ©pÃ´t contient 33 versions diffÃ©rents de l'inage '<em>agnhost</em>' et que la version la plus rÃ©cente est la 2.57.</p>
<p>N'oublions pas de vÃ©rifier la bonne crÃ©ation de l'<em>Image Policy</em> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">code</label><label for="__tabbed_15_2">Image Policy 'agnhost'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>imagepolicy
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>NAME<span class="w">      </span>LATESTIMAGE
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>agnhost<span class="w">   </span>registry.k8s.io/e2e-test-images/agnhost:2.10
</span></code></pre></div>
</div>
</div>
</div>
<p>Notre <em>image policy</em> telle que nous l'avons dÃ©finie va rechercher la version la plus ancienne de l'image Docker : <code>e2e-test-images/agnhost:2.10</code>.
Lorsque l'automatisation de la mise Ã  jour de l'image sera complÃ¨tement en place, notre application devrait donc Ãªtre '<em>downgradÃ©e</em>'.</p>
<h5 id="reecriture-du-tag-de-limage-docker">RÃ©Ã©criture du tag de l'image Docker</h5>
<p>Nous devons maintenant indiquer Ã  FluxCD oÃ¹ mettre le tag de l'image Ã  jour dans le manifest YAML de dÃ©ploiement de l'application '<em>agnhost</em>'.</p>
<p>En effet, si FluxCD est capable de dÃ©tecter dans l'<em>Image Repository</em> la version de l'image souhaitÃ©e telle que dÃ©finie dans notre '<em>Image Policy</em>' (dans notre cas, la plus ancienne des versions '2.xy'), il doit aussi modifier le manifest YAML du '<em>deployment</em>' en consÃ©quence.</p>
<p>Dans le cas de nos applications, l'image Docker et sa version sont dÃ©finis dans les manifests qui dÃ©crivent les <em>'deployments'</em> : </p>
<div class="admonition info">
<p class="admonition-title">Configure image update for custom resources</p>
<p><a href="https://fluxcd.io/flux/guides/image-update/#configure-image-update-for-custom-resources">https://fluxcd.io/flux/guides/image-update/#configure-image-update-for-custom-resources</a></p>
</div>
<p>FluxCD doit Ãªtre aidÃ© d'un marqueur que nous apposerons Ã  l'endroit adÃ©quate.</p>
<p>Le format du marqueur de l'image policy est le suivant :
<div class="language-sh highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>*<span class="w"> </span><span class="o">{</span><span class="s2">&quot;</span><span class="nv">$imagepolicy</span><span class="s2">&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;policy-namespace&gt;:&lt;policy-name&gt;&quot;</span><span class="o">}</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>*<span class="w"> </span><span class="o">{</span><span class="s2">&quot;</span><span class="nv">$imagepolicy</span><span class="s2">&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;policy-namespace&gt;:&lt;policy-name&gt;:tag&quot;</span><span class="o">}</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>*<span class="w"> </span><span class="o">{</span><span class="s2">&quot;</span><span class="nv">$imagepolicy</span><span class="s2">&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;policy-namespace&gt;:&lt;policy-name&gt;:name&quot;</span><span class="o">}</span>
</span></code></pre></div></p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">code</label><label for="__tabbed_16_2">agnhost/deployment.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>gsed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/agnhost:2\.39/agnhost:2\.39 # {&quot;$imagepolicy&quot;: &quot;agnhost:agnhost&quot;}/&#39;</span><span class="w"> </span>agnhost/agnhost.deployment.yaml
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: added a marker on foobar&#39;s pods manifests.&quot;</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>git<span class="w"> </span>push
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>apiVersion:<span class="w"> </span>apps/v1
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>kind:<span class="w"> </span>Deployment
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>metadata:
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span>labels:
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span>app:<span class="w"> </span>agnhost
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span>name:<span class="w"> </span>agnhost
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>spec:
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">  </span>replicas:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span>selector:
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">    </span>matchLabels:
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">      </span>app:<span class="w"> </span>agnhost
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">  </span>template:
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">    </span>metadata:
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">      </span>labels:
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">        </span>app:<span class="w"> </span>agnhost
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">    </span>spec:
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">      </span>containers:
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">      </span>-<span class="w"> </span>name:<span class="w"> </span>agnhost
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">        </span>image:<span class="w"> </span>registry.k8s.io/e2e-test-images/agnhost:2.39<span class="w"> </span><span class="c1"># {&quot;$imagepolicy&quot;: &quot;agnhost:agnhost&quot;}</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">        </span>command:
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="w">        </span>-<span class="w"> </span>/agnhost
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="w">        </span>-<span class="w"> </span>netexec
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="w">        </span>-<span class="w"> </span>--http-port
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">        </span>-<span class="w"> </span><span class="s2">&quot;8080&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h5 id="image-update-automation">Image Update Automation</h5>
<p>Il ne nous reste plus qu'Ã  tout mettre en musique en crÃ©ant une '<em>ImageUpdateAutomation</em>' pour notre application.</p>
<div class="admonition doc">
<p class="admonition-title">flux create image update</p>
<p><a href="https://fluxcd.io/flux/cmd/flux_create_image_update/#examples">https://fluxcd.io/flux/cmd/flux_create_image_update/#examples</a></p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">code</label><label for="__tabbed_17_2">ImageUpdateAutomation 'agnhost'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AUTHOR_EMAIL</span><span class="o">=</span><span class="s2">&quot;19983231-papafrancky@users.noreply.github.com&quot;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>flux<span class="w"> </span>create<span class="w"> </span>image<span class="w"> </span>update<span class="w"> </span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span>--git-repo-ref<span class="o">=</span>k8s-kind-apps<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span>--git-repo-path<span class="o">=</span><span class="s2">&quot;./agnhost&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">    </span>--checkout-branch<span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">    </span>--author-name<span class="o">=</span>FluxCD<span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">    </span>--author-email<span class="o">=</span><span class="si">${</span><span class="nv">AUTHOR_EMAIL</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">    </span>--commit-template<span class="o">=</span><span class="s2">&quot;{{range .Updated.Images}}{{println .}}{{end}}&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">    </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/agnhost.imageupdateautomation.yaml
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: defined ImageUpdateAutomations for agnhost application.&quot;</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>git<span class="w"> </span>push
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>---
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>apiVersion:<span class="w"> </span>image.toolkit.fluxcd.io/v1beta2
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>kind:<span class="w"> </span>ImageUpdateAutomation
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>metadata:
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span>name:<span class="w"> </span>agnhost
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>spec:
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">  </span>git:
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span>checkout:
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">      </span>ref:
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">        </span>branch:<span class="w"> </span>main
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">    </span>commit:
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">      </span>author:
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">        </span>email:<span class="w"> </span><span class="m">19983231</span>-papafrancky@users.noreply.github.com
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">        </span>name:<span class="w"> </span>FluxCD
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">      </span>messageTemplate:<span class="w"> </span><span class="s1">&#39;{{range .Updated.Images}}{{println .}}{{end}}&#39;</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">  </span>sourceRef:
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">    </span>kind:<span class="w"> </span>GitRepository
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">    </span>name:<span class="w"> </span>k8s-kind-apps
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">  </span>update:
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">    </span>path:<span class="w"> </span>./agnhost
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">    </span>strategy:<span class="w"> </span>Setters
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">DÃ©finir son adresse email de commit</p>
<p><a href="https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address#about-commit-email-addresses">https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address#about-commit-email-addresses</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Comment rÃ©cupÃ©rer l'ID de son compte GitHub</p>
<p>https://api.github.com/users/${GITHUB_USERNAME}</p>
</div>
<p>VÃ©rifions si la version de l'image Docker de notre application a changÃ© :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">code</label><label for="__tabbed_18_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].spec.containers[*].image}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>registry.k8s.io/e2e-test-images/agnhost:2.10
</span></code></pre></div>
</div>
</div>
</div>
<p>L'application '<em>agnhost</em>' dÃ©ployÃ©e sur notre cluster est passÃ©e de la version 2.39 Ã  2.10. Flux a bien rÃ©pondu Ã  nos attentes.</p>
<p>Pour constater le changement de version dans le manifest YAML de '<em>deployment</em>', nous pouvons regarder soit <a href="https://github.com/papafrancky/k8s-kind-apps/blob/main/agnhost/agnhost.deployment.yaml">directement sur le site GitHub</a>, soit sur notre copie locale, Ã  condition de la remettre Ã  jour au prÃ©alable:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">code</label><label for="__tabbed_19_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">   </span>git<span class="w"> </span>fetch
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">   </span>git<span class="w"> </span>pull
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Mise<span class="w"> </span>Ã <span class="w"> </span>jour<span class="w"> </span>66838d6..dfa98e7
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>Fast-forward
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>agnhost/agnhost.deployment.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>+-
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="m">1</span><span class="w"> </span>file<span class="w"> </span>changed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>insertion<span class="o">(</span>+<span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="w"> </span>deletion<span class="o">(</span>-<span class="o">)</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Les manifests ont bien Ã©tÃ© modifiÃ©s.
VÃ©rifions la mise Ã  jour de la version des images :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">code</label><label for="__tabbed_20_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>cat<span class="w"> </span>agnhost/agnhost.deployment.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>image:
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>image:<span class="w"> </span>registry.k8s.io/e2e-test-images/agnhost:2.10<span class="w"> </span><span class="c1"># {&quot;$imagepolicy&quot;: &quot;agnhost:agnhost&quot;}</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Le tag de l'image Docker a bien Ã©tÃ© rÃ©Ã©crit pour passer de la version 2.39 Ã  2.10.</p>
<p>Tout fonctionne comme attendu ! <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M464 256a208 208 0 1 0-416 0 208 208 0 1 0 416 0M0 256a256 256 0 1 1 512 0 256 256 0 1 1-512 0m118.3 58.2c-4.2-13.7 7.1-26.2 21.4-26.2h232.6c14.3 0 25.6 12.5 21.4 26.2C375.7 373.1 320.8 416 256 416s-119.7-42.9-137.7-101.8M144 192a32 32 0 1 1 64 0 32 32 0 1 1-64 0m164 8c0 11-9 20-20 20s-20-9-20-20c0-33.1 26.9-60 60-60h16c33.1 0 60 26.9 60 60 0 11-9 20-20 20s-20-9-20-20-9-20-20-20h-16c-11 0-20 9-20 20"/></svg></span></p>
<h3 id="gestion-des-applications-depuis-un-depot-helm">Gestion des applications depuis un dÃ©pÃ´t Helm</h3>
<p>Nous venons de couvrir l'intÃ©gration continue d'une application dont le code source est hÃ©bergÃ© dans un dÃ©pÃ´t Git (GitHub dans notre cas).</p>
<p>FluxCD est Ã©galement capable de gÃ©rer des applications packagÃ©es avec <strong>Helm</strong> directement depuis leur dÃ©pÃ´t de packages (et non plus de code source).
C'est ce sur quoi nous allons nous concentrer Ã  prÃ©sent.</p>
<p>Pour illustrer l'intÃ©gration continue d'applications packagÃ©es avec Helm, nous dÃ©ploierons l'application <em>'podinfo'</em> utilisÃ©e par le projet CNCF FluxCD pour faire des tests end-to-end et des workshops.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://github.com/stefanprodan/podinfo">https://github.com/stefanprodan/podinfo</a></p>
</div>
<h4 id="namespace-dedie-a-lapplication-podinfo">Namespace dÃ©diÃ© Ã  l'application <em>'podinfo'</em></h4>
<p>Comme pour la prÃ©cÃ©dente application, nous devons crÃ©er le namespace qui hÃ©bergera l'application '<em>podinfo</em>'.</p>
<p>Si nous ne crÃ©ons pas le namespace, il nous sera impossible de dÃ©finir de nouveaux objets Kubernetes qui y refont rÃ©fÃ©rence.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">code</label><label for="__tabbed_21_2">namespace 'podinfo'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">   </span>mkdir<span class="w"> </span>apps/podinfo
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">   </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>podinfo<span class="w"> </span>--dry-run<span class="o">=</span>client<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>./apps/podinfo/namespace.yaml
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">   </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>./apps/podinfo/podinfo.namespace.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>kind:<span class="w"> </span>Namespace
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>metadata:
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">  </span>creationTimestamp:<span class="w"> </span>null
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span>name:<span class="w"> </span>podinfo
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>spec:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w"> </span>status:<span class="w"> </span><span class="o">{}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="le-helm-chart-podinfo">Le Helm Chart <em>'podinfo'</em></h4>
<p>Le dÃ©pÃ´t GitHub de l'application <em>'podinfo'</em> propose un Helm Chart.</p>
<p>Il fait donc office de '<em>Helm Repository</em>' :</p>
<p><img alt="Depot GitHub de l'application podinfo" src="../images/podinfo_github_repo.png" /></p>
<h5 id="adresse-du-helm-chart-podinfo">Adresse du Helm Chart '<em>podinfo</em>'</h5>
<p>Pour retrouver l'adresse oÃ¹ rÃ©cupÃ©rer le '<em>Helm Chart</em>', cliquons sur le lien '<em>charts/podinfo</em>' dans la partie '<em>Packages</em>' de la colonne de droite de la UI GitHub : </p>
<p><img alt="Depot GitHub de l'application podinfo" src="../images/podinfo_github_repo_2.png" /></p>
<p>L'URL du <em>Helm Chart</em> de '<em>podinfo</em>' est donc : <code>oci://ghcr.io/stefanprodan/charts/podinfo</code>.</p>
<h5 id="authentification-aupres-du-helm-repository">Authentification auprÃ¨s du <em>Helm Repository</em></h5>
<p>Nous devons commencer par nous authentifier auprÃ¨s de la '<em>GitHub Container Registry</em>' (GHCR) :</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-with-a-personal-access-token-classic">Authenticating to the GitHub container registry with a personal access token</a></p>
</div>
<p>Puisque notre <em>Helm Repository</em> est GitHub, nous utiliserons nos '<em>credentials</em>' sur cette plateforme, c'est Ã  dire notre login et notre '<em>Personal Access Token</em>' (ou '<em>PAT</em>').</p>
<p>Testons tout de suite avant d'Ã©crire nos manifests YAML que nous confierons Ã  FluxCD :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><input id="__tabbed_22_2" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">code</label><label for="__tabbed_22_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>papaFrancky
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;my_github_personal_access_token&gt;
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_TOKEN</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>login<span class="w"> </span>ghcr.io<span class="w"> </span>-u<span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span>--password-stdin
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>Login<span class="w"> </span>Succeeded
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous sommes dÃ©sormais en mesure de l'interroger :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:3"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><input id="__tabbed_23_2" name="__tabbed_23" type="radio" /><input id="__tabbed_23_3" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">code</label><label for="__tabbed_23_2">'podinfo' Helm Chart information</label><label for="__tabbed_23_3">'podinfo' Helm Chart values</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>helm<span class="w"> </span>show<span class="w"> </span>chart<span class="w"> </span>oci://ghcr.io/stefanprodan/charts/podinfo
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>helm<span class="w"> </span>show<span class="w"> </span>values<span class="w"> </span>oci://ghcr.io/stefanprodan/charts/podinfo
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>Pulled:<span class="w"> </span>ghcr.io/stefanprodan/charts/podinfo:6.9.2
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>Digest:<span class="w"> </span>sha256:971fef0d04d5b3d03d035701dad59411ea0f60e28d16190f02469ddfe5587588
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>appVersion:<span class="w"> </span><span class="m">6</span>.9.2
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>description:<span class="w"> </span>Podinfo<span class="w"> </span>Helm<span class="w"> </span>chart<span class="w"> </span><span class="k">for</span><span class="w"> </span>Kubernetes
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>home:<span class="w"> </span>https://github.com/stefanprodan/podinfo
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>kubeVersion:<span class="w"> </span><span class="s1">&#39;&gt;=1.23.0-0&#39;</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>maintainers:
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>-<span class="w"> </span>email:<span class="w"> </span>stefanprodan@users.noreply.github.com
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">  </span>name:<span class="w"> </span>stefanprodan
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>name:<span class="w"> </span>podinfo
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>sources:
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>-<span class="w"> </span>https://github.com/stefanprodan/podinfo
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>version:<span class="w"> </span><span class="m">6</span>.9.2<span class="w">    </span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>Pulled:<span class="w"> </span>ghcr.io/stefanprodan/charts/podinfo:6.9.2
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>Digest:<span class="w"> </span>sha256:971fef0d04d5b3d03d035701dad59411ea0f60e28d16190f02469ddfe5587588
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="c1"># Default values for podinfo.</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>replicaCount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>logLevel:<span class="w"> </span>info
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>host:<span class="w"> </span><span class="c1">#0.0.0.0</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>backend:<span class="w"> </span><span class="c1">#http://backend-podinfo:9898/echo</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>backends:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>image:
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">  </span>repository:<span class="w"> </span>ghcr.io/stefanprodan/podinfo
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">  </span>tag:<span class="w"> </span><span class="m">6</span>.9.2
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">  </span>pullPolicy:<span class="w"> </span>IfNotPresent
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>ui:
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">  </span>color:<span class="w"> </span><span class="s2">&quot;#34577c&quot;</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">  </span>message:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">  </span>logo:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="c1"># failure conditions</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>faults:
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="w">  </span>delay:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="w">  </span>error:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a><span class="w">  </span>unhealthy:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a><span class="w">  </span>unready:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a><span class="w">  </span>testFail:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a><span class="w">  </span>testTimeout:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a><span class="c1"># Kubernetes Service settings</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>service:
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a><span class="w">  </span>annotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a><span class="w">  </span>type:<span class="w"> </span>ClusterIP
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a><span class="w">  </span>metricsPort:<span class="w"> </span><span class="m">9797</span>
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a><span class="w">  </span>httpPort:<span class="w"> </span><span class="m">9898</span>
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a><span class="w">  </span>externalPort:<span class="w"> </span><span class="m">9898</span>
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a><span class="w">  </span>grpcPort:<span class="w"> </span><span class="m">9999</span>
</span><span id="__span-53-39"><a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a><span class="w">  </span>grpcService:<span class="w"> </span>podinfo
</span><span id="__span-53-40"><a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a><span class="w">  </span>nodePort:<span class="w"> </span><span class="m">31198</span>
</span><span id="__span-53-41"><a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a><span class="w">  </span><span class="c1"># the port used to bind the http port to the host</span>
</span><span id="__span-53-42"><a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a><span class="w">  </span><span class="c1"># NOTE: requires privileged container with NET_BIND_SERVICE capability -- this is useful for testing</span>
</span><span id="__span-53-43"><a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a><span class="w">  </span><span class="c1"># in local clusters such as kind without port forwarding</span>
</span><span id="__span-53-44"><a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a><span class="w">  </span>hostPort:
</span><span id="__span-53-45"><a id="__codelineno-53-45" name="__codelineno-53-45" href="#__codelineno-53-45"></a>
</span><span id="__span-53-46"><a id="__codelineno-53-46" name="__codelineno-53-46" href="#__codelineno-53-46"></a><span class="c1"># enable h2c protocol (non-TLS version of HTTP/2)</span>
</span><span id="__span-53-47"><a id="__codelineno-53-47" name="__codelineno-53-47" href="#__codelineno-53-47"></a>h2c:
</span><span id="__span-53-48"><a id="__codelineno-53-48" name="__codelineno-53-48" href="#__codelineno-53-48"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-49"><a id="__codelineno-53-49" name="__codelineno-53-49" href="#__codelineno-53-49"></a>
</span><span id="__span-53-50"><a id="__codelineno-53-50" name="__codelineno-53-50" href="#__codelineno-53-50"></a><span class="c1"># config file settings</span>
</span><span id="__span-53-51"><a id="__codelineno-53-51" name="__codelineno-53-51" href="#__codelineno-53-51"></a>config:
</span><span id="__span-53-52"><a id="__codelineno-53-52" name="__codelineno-53-52" href="#__codelineno-53-52"></a><span class="w">  </span><span class="c1"># config file path</span>
</span><span id="__span-53-53"><a id="__codelineno-53-53" name="__codelineno-53-53" href="#__codelineno-53-53"></a><span class="w">  </span>path:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-54"><a id="__codelineno-53-54" name="__codelineno-53-54" href="#__codelineno-53-54"></a><span class="w">  </span><span class="c1"># config file name</span>
</span><span id="__span-53-55"><a id="__codelineno-53-55" name="__codelineno-53-55" href="#__codelineno-53-55"></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-56"><a id="__codelineno-53-56" name="__codelineno-53-56" href="#__codelineno-53-56"></a>
</span><span id="__span-53-57"><a id="__codelineno-53-57" name="__codelineno-53-57" href="#__codelineno-53-57"></a><span class="c1"># Additional command line arguments to pass to podinfo container</span>
</span><span id="__span-53-58"><a id="__codelineno-53-58" name="__codelineno-53-58" href="#__codelineno-53-58"></a>extraArgs:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-59"><a id="__codelineno-53-59" name="__codelineno-53-59" href="#__codelineno-53-59"></a>
</span><span id="__span-53-60"><a id="__codelineno-53-60" name="__codelineno-53-60" href="#__codelineno-53-60"></a><span class="c1"># enable tls on the podinfo service</span>
</span><span id="__span-53-61"><a id="__codelineno-53-61" name="__codelineno-53-61" href="#__codelineno-53-61"></a>tls:
</span><span id="__span-53-62"><a id="__codelineno-53-62" name="__codelineno-53-62" href="#__codelineno-53-62"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-63"><a id="__codelineno-53-63" name="__codelineno-53-63" href="#__codelineno-53-63"></a><span class="w">  </span><span class="c1"># the name of the secret used to mount the certificate key pair</span>
</span><span id="__span-53-64"><a id="__codelineno-53-64" name="__codelineno-53-64" href="#__codelineno-53-64"></a><span class="w">  </span>secretName:
</span><span id="__span-53-65"><a id="__codelineno-53-65" name="__codelineno-53-65" href="#__codelineno-53-65"></a><span class="w">  </span><span class="c1"># the path where the certificate key pair will be mounted</span>
</span><span id="__span-53-66"><a id="__codelineno-53-66" name="__codelineno-53-66" href="#__codelineno-53-66"></a><span class="w">  </span>certPath:<span class="w"> </span>/data/cert
</span><span id="__span-53-67"><a id="__codelineno-53-67" name="__codelineno-53-67" href="#__codelineno-53-67"></a><span class="w">  </span><span class="c1"># the port used to host the tls endpoint on the service</span>
</span><span id="__span-53-68"><a id="__codelineno-53-68" name="__codelineno-53-68" href="#__codelineno-53-68"></a><span class="w">  </span>port:<span class="w"> </span><span class="m">9899</span>
</span><span id="__span-53-69"><a id="__codelineno-53-69" name="__codelineno-53-69" href="#__codelineno-53-69"></a><span class="w">  </span><span class="c1"># the port used to bind the tls port to the host</span>
</span><span id="__span-53-70"><a id="__codelineno-53-70" name="__codelineno-53-70" href="#__codelineno-53-70"></a><span class="w">  </span><span class="c1"># NOTE: requires privileged container with NET_BIND_SERVICE capability -- this is useful for testing</span>
</span><span id="__span-53-71"><a id="__codelineno-53-71" name="__codelineno-53-71" href="#__codelineno-53-71"></a><span class="w">  </span><span class="c1"># in local clusters such as kind without port forwarding</span>
</span><span id="__span-53-72"><a id="__codelineno-53-72" name="__codelineno-53-72" href="#__codelineno-53-72"></a><span class="w">  </span>hostPort:
</span><span id="__span-53-73"><a id="__codelineno-53-73" name="__codelineno-53-73" href="#__codelineno-53-73"></a>
</span><span id="__span-53-74"><a id="__codelineno-53-74" name="__codelineno-53-74" href="#__codelineno-53-74"></a><span class="c1"># create a certificate manager certificate (cert-manager required)</span>
</span><span id="__span-53-75"><a id="__codelineno-53-75" name="__codelineno-53-75" href="#__codelineno-53-75"></a>certificate:
</span><span id="__span-53-76"><a id="__codelineno-53-76" name="__codelineno-53-76" href="#__codelineno-53-76"></a><span class="w">  </span>create:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-77"><a id="__codelineno-53-77" name="__codelineno-53-77" href="#__codelineno-53-77"></a><span class="w">  </span><span class="c1"># the issuer used to issue the certificate</span>
</span><span id="__span-53-78"><a id="__codelineno-53-78" name="__codelineno-53-78" href="#__codelineno-53-78"></a><span class="w">  </span>issuerRef:
</span><span id="__span-53-79"><a id="__codelineno-53-79" name="__codelineno-53-79" href="#__codelineno-53-79"></a><span class="w">    </span>kind:<span class="w"> </span>ClusterIssuer
</span><span id="__span-53-80"><a id="__codelineno-53-80" name="__codelineno-53-80" href="#__codelineno-53-80"></a><span class="w">    </span>name:<span class="w"> </span>self-signed
</span><span id="__span-53-81"><a id="__codelineno-53-81" name="__codelineno-53-81" href="#__codelineno-53-81"></a><span class="w">  </span><span class="c1"># the hostname / subject alternative names for the certificate</span>
</span><span id="__span-53-82"><a id="__codelineno-53-82" name="__codelineno-53-82" href="#__codelineno-53-82"></a><span class="w">  </span>dnsNames:
</span><span id="__span-53-83"><a id="__codelineno-53-83" name="__codelineno-53-83" href="#__codelineno-53-83"></a><span class="w">    </span>-<span class="w"> </span>podinfo
</span><span id="__span-53-84"><a id="__codelineno-53-84" name="__codelineno-53-84" href="#__codelineno-53-84"></a>
</span><span id="__span-53-85"><a id="__codelineno-53-85" name="__codelineno-53-85" href="#__codelineno-53-85"></a><span class="c1"># metrics-server add-on required</span>
</span><span id="__span-53-86"><a id="__codelineno-53-86" name="__codelineno-53-86" href="#__codelineno-53-86"></a>hpa:
</span><span id="__span-53-87"><a id="__codelineno-53-87" name="__codelineno-53-87" href="#__codelineno-53-87"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-88"><a id="__codelineno-53-88" name="__codelineno-53-88" href="#__codelineno-53-88"></a><span class="w">  </span>maxReplicas:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-53-89"><a id="__codelineno-53-89" name="__codelineno-53-89" href="#__codelineno-53-89"></a><span class="w">  </span><span class="c1"># average total CPU usage per pod (1-100)</span>
</span><span id="__span-53-90"><a id="__codelineno-53-90" name="__codelineno-53-90" href="#__codelineno-53-90"></a><span class="w">  </span>cpu:
</span><span id="__span-53-91"><a id="__codelineno-53-91" name="__codelineno-53-91" href="#__codelineno-53-91"></a><span class="w">  </span><span class="c1"># average memory usage per pod (100Mi-1Gi)</span>
</span><span id="__span-53-92"><a id="__codelineno-53-92" name="__codelineno-53-92" href="#__codelineno-53-92"></a><span class="w">  </span>memory:
</span><span id="__span-53-93"><a id="__codelineno-53-93" name="__codelineno-53-93" href="#__codelineno-53-93"></a><span class="w">  </span><span class="c1"># average http requests per second per pod (k8s-prometheus-adapter)</span>
</span><span id="__span-53-94"><a id="__codelineno-53-94" name="__codelineno-53-94" href="#__codelineno-53-94"></a><span class="w">  </span>requests:
</span><span id="__span-53-95"><a id="__codelineno-53-95" name="__codelineno-53-95" href="#__codelineno-53-95"></a>
</span><span id="__span-53-96"><a id="__codelineno-53-96" name="__codelineno-53-96" href="#__codelineno-53-96"></a><span class="c1"># Redis address in the format tcp://&lt;host&gt;:&lt;port&gt;</span>
</span><span id="__span-53-97"><a id="__codelineno-53-97" name="__codelineno-53-97" href="#__codelineno-53-97"></a>cache:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-98"><a id="__codelineno-53-98" name="__codelineno-53-98" href="#__codelineno-53-98"></a><span class="c1"># Redis deployment</span>
</span><span id="__span-53-99"><a id="__codelineno-53-99" name="__codelineno-53-99" href="#__codelineno-53-99"></a>redis:
</span><span id="__span-53-100"><a id="__codelineno-53-100" name="__codelineno-53-100" href="#__codelineno-53-100"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-101"><a id="__codelineno-53-101" name="__codelineno-53-101" href="#__codelineno-53-101"></a><span class="w">  </span>repository:<span class="w"> </span>redis
</span><span id="__span-53-102"><a id="__codelineno-53-102" name="__codelineno-53-102" href="#__codelineno-53-102"></a><span class="w">  </span>tag:<span class="w"> </span><span class="m">7</span>.0.7
</span><span id="__span-53-103"><a id="__codelineno-53-103" name="__codelineno-53-103" href="#__codelineno-53-103"></a>
</span><span id="__span-53-104"><a id="__codelineno-53-104" name="__codelineno-53-104" href="#__codelineno-53-104"></a>serviceAccount:
</span><span id="__span-53-105"><a id="__codelineno-53-105" name="__codelineno-53-105" href="#__codelineno-53-105"></a><span class="w">  </span><span class="c1"># Specifies whether a service account should be created</span>
</span><span id="__span-53-106"><a id="__codelineno-53-106" name="__codelineno-53-106" href="#__codelineno-53-106"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-107"><a id="__codelineno-53-107" name="__codelineno-53-107" href="#__codelineno-53-107"></a><span class="w">  </span><span class="c1"># The name of the service account to use.</span>
</span><span id="__span-53-108"><a id="__codelineno-53-108" name="__codelineno-53-108" href="#__codelineno-53-108"></a><span class="w">  </span><span class="c1"># If not set and create is true, a name is generated using the fullname template</span>
</span><span id="__span-53-109"><a id="__codelineno-53-109" name="__codelineno-53-109" href="#__codelineno-53-109"></a><span class="w">  </span>name:
</span><span id="__span-53-110"><a id="__codelineno-53-110" name="__codelineno-53-110" href="#__codelineno-53-110"></a><span class="w">  </span><span class="c1"># List of image pull secrets if pulling from private registries</span>
</span><span id="__span-53-111"><a id="__codelineno-53-111" name="__codelineno-53-111" href="#__codelineno-53-111"></a><span class="w">  </span>imagePullSecrets:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-112"><a id="__codelineno-53-112" name="__codelineno-53-112" href="#__codelineno-53-112"></a>
</span><span id="__span-53-113"><a id="__codelineno-53-113" name="__codelineno-53-113" href="#__codelineno-53-113"></a><span class="c1"># set container security context</span>
</span><span id="__span-53-114"><a id="__codelineno-53-114" name="__codelineno-53-114" href="#__codelineno-53-114"></a>securityContext:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-115"><a id="__codelineno-53-115" name="__codelineno-53-115" href="#__codelineno-53-115"></a>
</span><span id="__span-53-116"><a id="__codelineno-53-116" name="__codelineno-53-116" href="#__codelineno-53-116"></a><span class="c1"># set pod security context</span>
</span><span id="__span-53-117"><a id="__codelineno-53-117" name="__codelineno-53-117" href="#__codelineno-53-117"></a>podSecurityContext:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-118"><a id="__codelineno-53-118" name="__codelineno-53-118" href="#__codelineno-53-118"></a>
</span><span id="__span-53-119"><a id="__codelineno-53-119" name="__codelineno-53-119" href="#__codelineno-53-119"></a>ingress:
</span><span id="__span-53-120"><a id="__codelineno-53-120" name="__codelineno-53-120" href="#__codelineno-53-120"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-121"><a id="__codelineno-53-121" name="__codelineno-53-121" href="#__codelineno-53-121"></a><span class="w">  </span>className:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-53-122"><a id="__codelineno-53-122" name="__codelineno-53-122" href="#__codelineno-53-122"></a><span class="w">  </span>additionalLabels:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-123"><a id="__codelineno-53-123" name="__codelineno-53-123" href="#__codelineno-53-123"></a><span class="w">  </span>annotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-124"><a id="__codelineno-53-124" name="__codelineno-53-124" href="#__codelineno-53-124"></a><span class="w">    </span><span class="c1"># kubernetes.io/ingress.class: nginx</span>
</span><span id="__span-53-125"><a id="__codelineno-53-125" name="__codelineno-53-125" href="#__codelineno-53-125"></a><span class="w">    </span><span class="c1"># kubernetes.io/tls-acme: &quot;true&quot;</span>
</span><span id="__span-53-126"><a id="__codelineno-53-126" name="__codelineno-53-126" href="#__codelineno-53-126"></a><span class="w">  </span>hosts:
</span><span id="__span-53-127"><a id="__codelineno-53-127" name="__codelineno-53-127" href="#__codelineno-53-127"></a><span class="w">    </span>-<span class="w"> </span>host:<span class="w"> </span>podinfo.local
</span><span id="__span-53-128"><a id="__codelineno-53-128" name="__codelineno-53-128" href="#__codelineno-53-128"></a><span class="w">      </span>paths:
</span><span id="__span-53-129"><a id="__codelineno-53-129" name="__codelineno-53-129" href="#__codelineno-53-129"></a><span class="w">        </span>-<span class="w"> </span>path:<span class="w"> </span>/
</span><span id="__span-53-130"><a id="__codelineno-53-130" name="__codelineno-53-130" href="#__codelineno-53-130"></a><span class="w">          </span>pathType:<span class="w"> </span>ImplementationSpecific
</span><span id="__span-53-131"><a id="__codelineno-53-131" name="__codelineno-53-131" href="#__codelineno-53-131"></a><span class="w">  </span>tls:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-132"><a id="__codelineno-53-132" name="__codelineno-53-132" href="#__codelineno-53-132"></a><span class="w">  </span><span class="c1">#  - secretName: chart-example-tls</span>
</span><span id="__span-53-133"><a id="__codelineno-53-133" name="__codelineno-53-133" href="#__codelineno-53-133"></a><span class="w">  </span><span class="c1">#    hosts:</span>
</span><span id="__span-53-134"><a id="__codelineno-53-134" name="__codelineno-53-134" href="#__codelineno-53-134"></a><span class="w">  </span><span class="c1">#      - chart-example.local</span>
</span><span id="__span-53-135"><a id="__codelineno-53-135" name="__codelineno-53-135" href="#__codelineno-53-135"></a>
</span><span id="__span-53-136"><a id="__codelineno-53-136" name="__codelineno-53-136" href="#__codelineno-53-136"></a>linkerd:
</span><span id="__span-53-137"><a id="__codelineno-53-137" name="__codelineno-53-137" href="#__codelineno-53-137"></a><span class="w">  </span>profile:
</span><span id="__span-53-138"><a id="__codelineno-53-138" name="__codelineno-53-138" href="#__codelineno-53-138"></a><span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-139"><a id="__codelineno-53-139" name="__codelineno-53-139" href="#__codelineno-53-139"></a>
</span><span id="__span-53-140"><a id="__codelineno-53-140" name="__codelineno-53-140" href="#__codelineno-53-140"></a><span class="c1"># create Prometheus Operator monitor</span>
</span><span id="__span-53-141"><a id="__codelineno-53-141" name="__codelineno-53-141" href="#__codelineno-53-141"></a>serviceMonitor:
</span><span id="__span-53-142"><a id="__codelineno-53-142" name="__codelineno-53-142" href="#__codelineno-53-142"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-143"><a id="__codelineno-53-143" name="__codelineno-53-143" href="#__codelineno-53-143"></a><span class="w">  </span>interval:<span class="w"> </span>15s
</span><span id="__span-53-144"><a id="__codelineno-53-144" name="__codelineno-53-144" href="#__codelineno-53-144"></a><span class="w">  </span>additionalLabels:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-145"><a id="__codelineno-53-145" name="__codelineno-53-145" href="#__codelineno-53-145"></a>
</span><span id="__span-53-146"><a id="__codelineno-53-146" name="__codelineno-53-146" href="#__codelineno-53-146"></a>resources:
</span><span id="__span-53-147"><a id="__codelineno-53-147" name="__codelineno-53-147" href="#__codelineno-53-147"></a><span class="w">  </span>limits:
</span><span id="__span-53-148"><a id="__codelineno-53-148" name="__codelineno-53-148" href="#__codelineno-53-148"></a><span class="w">  </span>requests:
</span><span id="__span-53-149"><a id="__codelineno-53-149" name="__codelineno-53-149" href="#__codelineno-53-149"></a><span class="w">    </span>cpu:<span class="w"> </span>1m
</span><span id="__span-53-150"><a id="__codelineno-53-150" name="__codelineno-53-150" href="#__codelineno-53-150"></a><span class="w">    </span>memory:<span class="w"> </span>16Mi
</span><span id="__span-53-151"><a id="__codelineno-53-151" name="__codelineno-53-151" href="#__codelineno-53-151"></a>
</span><span id="__span-53-152"><a id="__codelineno-53-152" name="__codelineno-53-152" href="#__codelineno-53-152"></a><span class="c1"># Extra environment variables for the podinfo container</span>
</span><span id="__span-53-153"><a id="__codelineno-53-153" name="__codelineno-53-153" href="#__codelineno-53-153"></a>extraEnvs:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-154"><a id="__codelineno-53-154" name="__codelineno-53-154" href="#__codelineno-53-154"></a><span class="c1"># Example on how to configure extraEnvs</span>
</span><span id="__span-53-155"><a id="__codelineno-53-155" name="__codelineno-53-155" href="#__codelineno-53-155"></a><span class="c1">#  - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</span>
</span><span id="__span-53-156"><a id="__codelineno-53-156" name="__codelineno-53-156" href="#__codelineno-53-156"></a><span class="c1">#    value: &quot;http://otel:4317&quot;</span>
</span><span id="__span-53-157"><a id="__codelineno-53-157" name="__codelineno-53-157" href="#__codelineno-53-157"></a><span class="c1">#  - name: MULTIPLE_VALUES</span>
</span><span id="__span-53-158"><a id="__codelineno-53-158" name="__codelineno-53-158" href="#__codelineno-53-158"></a><span class="c1">#    value: TEST</span>
</span><span id="__span-53-159"><a id="__codelineno-53-159" name="__codelineno-53-159" href="#__codelineno-53-159"></a>
</span><span id="__span-53-160"><a id="__codelineno-53-160" name="__codelineno-53-160" href="#__codelineno-53-160"></a>nodeSelector:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-161"><a id="__codelineno-53-161" name="__codelineno-53-161" href="#__codelineno-53-161"></a>
</span><span id="__span-53-162"><a id="__codelineno-53-162" name="__codelineno-53-162" href="#__codelineno-53-162"></a>tolerations:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-163"><a id="__codelineno-53-163" name="__codelineno-53-163" href="#__codelineno-53-163"></a>
</span><span id="__span-53-164"><a id="__codelineno-53-164" name="__codelineno-53-164" href="#__codelineno-53-164"></a>affinity:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-165"><a id="__codelineno-53-165" name="__codelineno-53-165" href="#__codelineno-53-165"></a>
</span><span id="__span-53-166"><a id="__codelineno-53-166" name="__codelineno-53-166" href="#__codelineno-53-166"></a>podAnnotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-167"><a id="__codelineno-53-167" name="__codelineno-53-167" href="#__codelineno-53-167"></a>
</span><span id="__span-53-168"><a id="__codelineno-53-168" name="__codelineno-53-168" href="#__codelineno-53-168"></a><span class="c1"># https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/</span>
</span><span id="__span-53-169"><a id="__codelineno-53-169" name="__codelineno-53-169" href="#__codelineno-53-169"></a>topologySpreadConstraints:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-53-170"><a id="__codelineno-53-170" name="__codelineno-53-170" href="#__codelineno-53-170"></a>
</span><span id="__span-53-171"><a id="__codelineno-53-171" name="__codelineno-53-171" href="#__codelineno-53-171"></a><span class="c1"># Disruption budget will be configured only when the replicaCount is greater than 1</span>
</span><span id="__span-53-172"><a id="__codelineno-53-172" name="__codelineno-53-172" href="#__codelineno-53-172"></a>podDisruptionBudget:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-53-173"><a id="__codelineno-53-173" name="__codelineno-53-173" href="#__codelineno-53-173"></a><span class="c1">#  maxUnavailable: 1</span>
</span><span id="__span-53-174"><a id="__codelineno-53-174" name="__codelineno-53-174" href="#__codelineno-53-174"></a>
</span><span id="__span-53-175"><a id="__codelineno-53-175" name="__codelineno-53-175" href="#__codelineno-53-175"></a>
</span><span id="__span-53-176"><a id="__codelineno-53-176" name="__codelineno-53-176" href="#__codelineno-53-176"></a><span class="c1"># https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#container-probes</span>
</span><span id="__span-53-177"><a id="__codelineno-53-177" name="__codelineno-53-177" href="#__codelineno-53-177"></a>probes:
</span><span id="__span-53-178"><a id="__codelineno-53-178" name="__codelineno-53-178" href="#__codelineno-53-178"></a><span class="w">  </span>readiness:
</span><span id="__span-53-179"><a id="__codelineno-53-179" name="__codelineno-53-179" href="#__codelineno-53-179"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-180"><a id="__codelineno-53-180" name="__codelineno-53-180" href="#__codelineno-53-180"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-53-181"><a id="__codelineno-53-181" name="__codelineno-53-181" href="#__codelineno-53-181"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-53-182"><a id="__codelineno-53-182" name="__codelineno-53-182" href="#__codelineno-53-182"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-183"><a id="__codelineno-53-183" name="__codelineno-53-183" href="#__codelineno-53-183"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-53-184"><a id="__codelineno-53-184" name="__codelineno-53-184" href="#__codelineno-53-184"></a><span class="w">  </span>liveness:
</span><span id="__span-53-185"><a id="__codelineno-53-185" name="__codelineno-53-185" href="#__codelineno-53-185"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-186"><a id="__codelineno-53-186" name="__codelineno-53-186" href="#__codelineno-53-186"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-53-187"><a id="__codelineno-53-187" name="__codelineno-53-187" href="#__codelineno-53-187"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-53-188"><a id="__codelineno-53-188" name="__codelineno-53-188" href="#__codelineno-53-188"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-189"><a id="__codelineno-53-189" name="__codelineno-53-189" href="#__codelineno-53-189"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-53-190"><a id="__codelineno-53-190" name="__codelineno-53-190" href="#__codelineno-53-190"></a><span class="w">  </span>startup:
</span><span id="__span-53-191"><a id="__codelineno-53-191" name="__codelineno-53-191" href="#__codelineno-53-191"></a><span class="w">    </span>enable:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-53-192"><a id="__codelineno-53-192" name="__codelineno-53-192" href="#__codelineno-53-192"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-53-193"><a id="__codelineno-53-193" name="__codelineno-53-193" href="#__codelineno-53-193"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-53-194"><a id="__codelineno-53-194" name="__codelineno-53-194" href="#__codelineno-53-194"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">20</span>
</span><span id="__span-53-195"><a id="__codelineno-53-195" name="__codelineno-53-195" href="#__codelineno-53-195"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-196"><a id="__codelineno-53-196" name="__codelineno-53-196" href="#__codelineno-53-196"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Nos '<em>credentials</em>' ainsi que l'adresse du Helm Chart sont vÃ©rifiÃ©s et exploitables, nous pouvons continuer.</p>
<h4 id="le-helmrepository-podinfo">Le HelmRepository '<em>podinfo</em>'</h4>
<h5 id="authentification-au-helm-repository">Authentification au Helm Repository</h5>
<p>Nous devons crÃ©er un '<em>secret</em>' de type '<em>Docker registry</em>' pour nous y authentifier, comme nous venons de le faire pour rÃ©cupÃ©rer des informations Ã  propos du Helm Chart. S'agissant d'un '<em>secret</em>', nous ne le placerons pas dans notre dÃ©pÃ´t GitHub.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:2"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><input id="__tabbed_24_2" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">code</label><label for="__tabbed_24_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>papafrancky
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;my_github_personal_access_token&gt;
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>docker-registry<span class="w"> </span>podinfo-helmrepository<span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">  </span>--docker-server<span class="o">=</span>ghcr.io<span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">  </span>--docker-username<span class="o">=</span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">  </span>--docker-password<span class="o">=</span><span class="si">${</span><span class="nv">GITHUB_TOKEN</span><span class="si">}</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>podinfo-helmrepository
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>items:
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>-<span class="w"> </span>apiVersion:<span class="w"> </span>v1
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">  </span>data:
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span>.dockerconfigjson:<span class="w"> </span><span class="nv">eyJhdXRocyI6eyJnaGNyLmlvIjp7InVzZXJuYW1lIjoicGFwYWZyYX5ja9kiLCJwYXNzd29yZCI6ImdocF9vTmNQZHlQRU04SlllT4diN0VQYWZ6Yk1XQk5zNmQ0MFRuMUciLCJhdXRoIjoiY0dGd1lXWnlZVzVqYTNrNloyaHdYMjlPWTFCa2VWQkZUVGhLV1dWaloySTNSVkJoWm5waVRWZENUbk0yWkRRd0KHNHhSdz09In19fQ</span><span class="o">==</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">  </span>kind:<span class="w"> </span>Secret
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">  </span>metadata:
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-10-04T09:14:05Z&quot;</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">    </span>name:<span class="w"> </span>podinfo-helmrepository
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">    </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;356702&quot;</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span>uid:<span class="w"> </span>431c3c9f-0790-49ed-928c-2e0f774b1da6
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">  </span>type:<span class="w"> </span>kubernetes.io/dockerconfigjson
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>kind:<span class="w"> </span>List
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>metadata:
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">  </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h5 id="definition-du-helmrepository">DÃ©finition du HelmRepository</h5>
<div class="tabbed-set tabbed-alternate" data-tabs="25:2"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><input id="__tabbed_25_2" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">code</label><label for="__tabbed_25_2">podinfo HelmRepository</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>flux<span class="w"> </span>create<span class="w"> </span><span class="nb">source</span><span class="w"> </span>helm<span class="w"> </span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>--url<span class="o">=</span>https://stefanprodan.github.io/podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>--secret-ref<span class="o">=</span>podinfo-helmrepository<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>--interval<span class="o">=</span>10m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>--export<span class="w"> </span>&gt;<span class="w"> </span>./apps/podinfo/podinfo.helmrepository.yaml
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="c1">#git add .</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="c1">#git commit -m &#39;Defined helmrepository for podinfo application.&#39;</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="c1">#git push</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>---
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>apiVersion:<span class="w"> </span>source.toolkit.fluxcd.io/v1
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>kind:<span class="w"> </span>HelmRepository
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>metadata:
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">  </span>name:<span class="w"> </span>podinfo
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>spec:
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">  </span>interval:<span class="w"> </span>10m0s
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">  </span>secretRef:
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="w">    </span>name:<span class="w"> </span>podinfo-helmrepository
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="w">  </span>url:<span class="w"> </span>https://stefanprodan.github.io/podinfo
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="le-gitrepository-pour-lapplication-podinfo">Le GitRepository pour l'application '<em>podinfo</em>'</h4>
<p>Dans la sÃ©grÃ©gation des rÃ´les entre Devs et Ops, la dÃ©finition de la HelmRelease incombera Ã  l'Ã©quipe de Dev en charge de l'application.</p>
<p>C'est elle qui personnalisera son application en surchargeant les valeurs par dÃ©faut de la Helm Chart utilisÃ©e (nous couvrirons la dÃ©finition de la HelmRelease ensuite).</p>
<p>Ces objets seront donc dÃ©finis dans des manifests YAML dans le dÃ©pÃ´t GitHub dÃ©diÃ© aux applications : <code>https://github.com/${GITHUB_USER}/k8s-kind-apps</code>.</p>
<h5 id="deploy-key">Deploy Key</h5>
<p>Pour permettre Ã  FluxCD de se connecter au dÃ©pÃ´t GitHub des applications dont il doit gÃ©rer l'intÃ©gration continue, nous devons crÃ©er une paire de clÃ©s SSH et dÃ©ployer la clÃ© publique sur les dÃ©pÃ´ts concernÃ©s.</p>
<p>Nous avons besoin de dÃ©finir les '<em>deploy keys</em>' avant de pouvoir dÃ©finir un '<em>GitRepository</em>'.</p>
<p>S'agissant de '<em>secrets</em>', nous ne conserverons pas le manifest YAML un le dÃ©pÃ´t GitHub. La solution idÃ©ale serait d'utiliser un coffre (ou '<em>vault</em>') pour gÃ©rer les '<em>secrets</em>' en toute sÃ©curitÃ©, sujet que nous couvrirons dans un autre HOWTO.</p>
<h6 id="creation-de-la-deploy-key_1">CrÃ©ation de la <em>'Deploy Key'</em></h6>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>flux<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>git<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">  </span>--url<span class="o">=</span>ssh://github.com/<span class="si">${</span><span class="nv">GITHUB_USERNAME</span><span class="si">}</span>/k8s-kind-apps<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo
</span></code></pre></div>
<p>VÃ©rifions la bonne crÃ©ation de la '<em>deploy key</em>' pour de dÃ©pÃ´t des applications :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:2"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><input id="__tabbed_26_2" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">code</label><label for="__tabbed_26_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>NAME<span class="w">                                     </span>TYPE<span class="w">     </span>DATA<span class="w">   </span>AGE
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>k8s-kind-apps-gitrepository-deploykeys<span class="w">   </span>Opaque<span class="w">   </span><span class="m">3</span><span class="w">      </span>3s
</span></code></pre></div>
</div>
</div>
</div>
<p>De ce '<em>secret</em>' qui contient un jeu de clÃ©s privÃ©e et publique, nous devons extraire la clÃ© publique pour la renseigner sur notre dÃ©pÃ´t GitHub :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="27:2"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><input id="__tabbed_27_2" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">code</label><label for="__tabbed_27_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.identity\.pub}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-D
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>ecdsa-sha2-nistp384<span class="w"> </span>AAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzODQAAABhBKbw9yMbN8SPIJQ9P8DZwGU7WJZuwKtrc4KM23aHLFBCQyx8op4/v62/ehtiaZnrH45g9OLGCwhq583Sc/DrgCl/cPJSaWbDVkXGoxfwPYG5uhrS0kejbPXWtlSAUZwOEg<span class="o">==</span>
</span></code></pre></div>
</div>
</div>
</div>
<h6 id="deploiement-de-la-deploy-key-sur-le-depot-github_1">DÃ©ploiement de la '<em>Deploy Key</em>' sur le dÃ©pÃ´t GitHub</h6>
<p>Nous devons ensuite dÃ©ployer la clÃ© publique sur le dÃ©pÃ´t GitHub <a href="http://127.0.0.1:8000/FluxCD/FluxCD_demonstration_par_l_exemple/#deploiement-de-la-deploy-key-sur-le-depot-github">comme nous l'avons fait pour l'application '<em>agnhost</em>'</a>.</p>
<p><img alt="Deploy key podinfo" src="../images/github_add_podinfo_public_key.png" /></p>
<h5 id="definition-du-gitrepository_1">DÃ©finition du GitRepository</h5>
<p>Maintenant que nous avons dÃ©fini la '<em>Deploy Key</em>', nous pouvons nous atteler Ã  la dÃ©finition du GitRepository oÃ¹ seront placÃ©s la HelmRelease de '<em>podinfo</em>' ainsi que ses '**values' customisÃ©es :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="28:2"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><input id="__tabbed_28_2" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">code</label><label for="__tabbed_28_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>papafrancky
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>flux<span class="w"> </span>create<span class="w"> </span><span class="nb">source</span><span class="w"> </span>git<span class="w"> </span>k8s-kind-apps<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">  </span>--url<span class="o">=</span>ssh://git@github.com/<span class="si">${</span><span class="nv">GITHUB_USERNAME</span><span class="si">}</span>/k8s-kind-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">  </span>--branch<span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">  </span>--secret-ref<span class="o">=</span>k8s-kind-apps-gitrepository-deploykeys<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/podinfo/k8s-kind-apps.gitrepository.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>---
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>apiVersion:<span class="w"> </span>source.toolkit.fluxcd.io/v1
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>kind:<span class="w"> </span>GitRepository
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>metadata:
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">  </span>name:<span class="w"> </span>k8s-kind-apps
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>spec:
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">  </span>ref:
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">    </span>branch:<span class="w"> </span>main
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w">  </span>secretRef:
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">    </span>name:<span class="w"> </span>k8s-kind-apps-gitrepository-deploykeys
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">  </span>url:<span class="w"> </span>ssh://git@github.com//k8s-kind-apps.git
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="kustomization-du-gitrepository-pour-lapplication-podinfo">Kustomization du GitRepository pour l'application '<em>podinfo</em>'</h4>
<p>Nous devons indiquer Ã  FluxCD qu'il doit gÃ©rer les manifests qu'il trouvera dansle GitRepository '<em>k8s-kind-apps </em>', dans le sous-rÃ©pertoire dÃ©diÃ© Ã  l'application '<em>podinfo</em>' (puisque nous avons pris le parti de partager un mÃªme dÃ©pÃ´t GitHub pour nos applications) : <code>./podinfo</code></p>
<p>C'est le rÃ´le de la '<em>Kustomization</em>'.</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/cmd/flux_create_kustomization/">https://fluxcd.io/flux/cmd/flux_create_kustomization/</a></p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="29:2"><input checked="checked" id="__tabbed_29_1" name="__tabbed_29" type="radio" /><input id="__tabbed_29_2" name="__tabbed_29" type="radio" /><div class="tabbed-labels"><label for="__tabbed_29_1">code</label><label for="__tabbed_29_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>flux<span class="w"> </span>create<span class="w"> </span>kustomization<span class="w"> </span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">  </span>--source<span class="o">=</span>GitRepository/k8s-kind-apps.podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">  </span>--path<span class="o">=</span><span class="s2">&quot;./podinfo&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">  </span>--prune<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">  </span>--interval<span class="o">=</span>1m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">  </span>--export<span class="w">  </span>&gt;<span class="w"> </span>apps/podinfo/podinfo.kustomization.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>---
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>apiVersion:<span class="w"> </span>kustomize.toolkit.fluxcd.io/v1
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>kind:<span class="w"> </span>Kustomization
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>metadata:
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">  </span>name:<span class="w"> </span>podinfo
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>spec:
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w">  </span>path:<span class="w"> </span>./podinfo
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">  </span>prune:<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">  </span>sourceRef:
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">    </span>kind:<span class="w"> </span>GitRepository
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">    </span>name:<span class="w"> </span>k8s-kind-apps
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w">    </span>namespace:<span class="w"> </span>podinfo
</span></code></pre></div>
</div>
</div>
</div>
<p>Poussons les nouveaux manifests YAML dans notre dÃ©pÃ´t GitHub :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Added GitRepository, HelmRepository and Kustomization for podinfo app.&#39;</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>git<span class="w"> </span>push
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>VÃ©rifions la crÃ©ation des nouveaux objets Kubernetes :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="30:2"><input checked="checked" id="__tabbed_30_1" name="__tabbed_30" type="radio" /><input id="__tabbed_30_2" name="__tabbed_30" type="radio" /><div class="tabbed-labels"><label for="__tabbed_30_1">code</label><label for="__tabbed_30_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>gitrepo,helmrepo,ks
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>NAME<span class="w">                                                   </span>URL<span class="w">                                                  </span>AGE<span class="w">   </span>READY<span class="w">   </span>STATUS
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>gitrepository.source.toolkit.fluxcd.io/k8s-kind-apps<span class="w">   </span>ssh://git@github.com/papafrancky/k8s-kind-apps.git<span class="w">   </span>1m<span class="w">   </span>True<span class="w">    </span>stored<span class="w"> </span>artifact<span class="w"> </span><span class="k">for</span><span class="w"> </span>revision<span class="w"> </span><span class="s1">&#39;main@sha1:dfa98e76317ed1c3d1901d721e53d55e4f61f96c&#39;</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>NAME<span class="w">                                              </span>URL<span class="w">                                      </span>AGE<span class="w">   </span>READY<span class="w">   </span>STATUS
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>helmrepository.source.toolkit.fluxcd.io/podinfo<span class="w">   </span>https://stefanprodan.github.io/podinfo<span class="w">   </span>1m<span class="w">   </span>True<span class="w">    </span>stored<span class="w"> </span>artifact:<span class="w"> </span>revision<span class="w"> </span><span class="s1">&#39;sha256:c0d4535103105a4bb59954a178f24bdb7dbac3072758312c8b3f09fb3d85f192&#39;</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>NAME<span class="w">                                                </span>AGE<span class="w">   </span>READY<span class="w">   </span>STATUS
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>kustomization.kustomize.toolkit.fluxcd.io/podinfo<span class="w">   </span>1m<span class="w">   </span>False<span class="w">   </span>kustomization<span class="w"> </span>path<span class="w"> </span>not<span class="w"> </span>found:<span class="w"> </span>stat<span class="w"> </span>/tmp/kustomization-2457791261/podinfo:<span class="w"> </span>no<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous constatons que la '<em>kustomization</em>' ne se trouve pas dans l'Ã©tat attendu. Et pour cause : nous n'avons pas encore dÃ©fini aucun objet (<em>HelmRelease</em> et <em>custom values</em>) dans le dÃ©pÃ´t GitHub des applications '<em>k8s-kind-apps</em>', qui ne contient en consÃ©quence pas de sous-rÃ©pertoire '<em>podinfo</em>' !</p>
<p>Il est temps de s'en occuper Ã  prÃ©sent.</p>
<h4 id="la-helm-release">La Helm Release</h4>
<p>Une '<em>Helm Release</em>' est une instance d'une '<em>Helm Chart</em>' dÃ©ployÃ©e sur un cluster Kubernetes.</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p>https://helm.sh/docs/glossary/#release</p>
</div>
<h5 id="personnalisation-de-la-helm-release-podinfo">Personnalisation de la Helm Release '<em>podinfo</em>'</h5>
<p>L'application '<em>podinfo</em>' est paramÃ©trÃ©e avec des valeurs par dÃ©faut dÃ©finies dans ce qu'on appelle les '<em>values</em>' de la Helm Chart.</p>
<p>Pour connaÃ®tre les valeurs par dÃ©faut de l'application : </p>
<div class="tabbed-set tabbed-alternate" data-tabs="31:2"><input checked="checked" id="__tabbed_31_1" name="__tabbed_31" type="radio" /><input id="__tabbed_31_2" name="__tabbed_31" type="radio" /><div class="tabbed-labels"><label for="__tabbed_31_1">code</label><label for="__tabbed_31_2">podinfo default values</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>papafrancky
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;my_github_personal_access_token&gt;
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_TOKEN</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>login<span class="w"> </span>ghcr.io<span class="w"> </span>-u<span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span>--password-stdin
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>helm<span class="w"> </span>show<span class="w"> </span>values<span class="w"> </span>oci://ghcr.io/stefanprodan/charts/podinfo
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1"># Default values for podinfo.</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>replicaCount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>logLevel:<span class="w"> </span>info
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>host:<span class="w"> </span><span class="c1">#0.0.0.0</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>backend:<span class="w"> </span><span class="c1">#http://backend-podinfo:9898/echo</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>backends:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>image:
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">  </span>repository:<span class="w"> </span>ghcr.io/stefanprodan/podinfo
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="w">  </span>tag:<span class="w"> </span><span class="m">6</span>.9.2
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">  </span>pullPolicy:<span class="w"> </span>IfNotPresent
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a>ui:
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="w">  </span>color:<span class="w"> </span><span class="s2">&quot;#34577c&quot;</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="w">  </span>message:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="w">  </span>logo:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a><span class="c1"># failure conditions</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a>faults:
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a><span class="w">  </span>delay:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a><span class="w">  </span>error:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a><span class="w">  </span>unhealthy:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-24"><a id="__codelineno-71-24" name="__codelineno-71-24" href="#__codelineno-71-24"></a><span class="w">  </span>unready:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-25"><a id="__codelineno-71-25" name="__codelineno-71-25" href="#__codelineno-71-25"></a><span class="w">  </span>testFail:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-26"><a id="__codelineno-71-26" name="__codelineno-71-26" href="#__codelineno-71-26"></a><span class="w">  </span>testTimeout:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-27"><a id="__codelineno-71-27" name="__codelineno-71-27" href="#__codelineno-71-27"></a>
</span><span id="__span-71-28"><a id="__codelineno-71-28" name="__codelineno-71-28" href="#__codelineno-71-28"></a><span class="c1"># Kubernetes Service settings</span>
</span><span id="__span-71-29"><a id="__codelineno-71-29" name="__codelineno-71-29" href="#__codelineno-71-29"></a>service:
</span><span id="__span-71-30"><a id="__codelineno-71-30" name="__codelineno-71-30" href="#__codelineno-71-30"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-71-31"><a id="__codelineno-71-31" name="__codelineno-71-31" href="#__codelineno-71-31"></a><span class="w">  </span>annotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-32"><a id="__codelineno-71-32" name="__codelineno-71-32" href="#__codelineno-71-32"></a><span class="w">  </span>type:<span class="w"> </span>ClusterIP
</span><span id="__span-71-33"><a id="__codelineno-71-33" name="__codelineno-71-33" href="#__codelineno-71-33"></a><span class="w">  </span>metricsPort:<span class="w"> </span><span class="m">9797</span>
</span><span id="__span-71-34"><a id="__codelineno-71-34" name="__codelineno-71-34" href="#__codelineno-71-34"></a><span class="w">  </span>httpPort:<span class="w"> </span><span class="m">9898</span>
</span><span id="__span-71-35"><a id="__codelineno-71-35" name="__codelineno-71-35" href="#__codelineno-71-35"></a><span class="w">  </span>externalPort:<span class="w"> </span><span class="m">9898</span>
</span><span id="__span-71-36"><a id="__codelineno-71-36" name="__codelineno-71-36" href="#__codelineno-71-36"></a><span class="w">  </span>grpcPort:<span class="w"> </span><span class="m">9999</span>
</span><span id="__span-71-37"><a id="__codelineno-71-37" name="__codelineno-71-37" href="#__codelineno-71-37"></a><span class="w">  </span>grpcService:<span class="w"> </span>podinfo
</span><span id="__span-71-38"><a id="__codelineno-71-38" name="__codelineno-71-38" href="#__codelineno-71-38"></a><span class="w">  </span>nodePort:<span class="w"> </span><span class="m">31198</span>
</span><span id="__span-71-39"><a id="__codelineno-71-39" name="__codelineno-71-39" href="#__codelineno-71-39"></a><span class="w">  </span><span class="c1"># the port used to bind the http port to the host</span>
</span><span id="__span-71-40"><a id="__codelineno-71-40" name="__codelineno-71-40" href="#__codelineno-71-40"></a><span class="w">  </span><span class="c1"># NOTE: requires privileged container with NET_BIND_SERVICE capability -- this is useful for testing</span>
</span><span id="__span-71-41"><a id="__codelineno-71-41" name="__codelineno-71-41" href="#__codelineno-71-41"></a><span class="w">  </span><span class="c1"># in local clusters such as kind without port forwarding</span>
</span><span id="__span-71-42"><a id="__codelineno-71-42" name="__codelineno-71-42" href="#__codelineno-71-42"></a><span class="w">  </span>hostPort:
</span><span id="__span-71-43"><a id="__codelineno-71-43" name="__codelineno-71-43" href="#__codelineno-71-43"></a>
</span><span id="__span-71-44"><a id="__codelineno-71-44" name="__codelineno-71-44" href="#__codelineno-71-44"></a><span class="c1"># enable h2c protocol (non-TLS version of HTTP/2)</span>
</span><span id="__span-71-45"><a id="__codelineno-71-45" name="__codelineno-71-45" href="#__codelineno-71-45"></a>h2c:
</span><span id="__span-71-46"><a id="__codelineno-71-46" name="__codelineno-71-46" href="#__codelineno-71-46"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-47"><a id="__codelineno-71-47" name="__codelineno-71-47" href="#__codelineno-71-47"></a>
</span><span id="__span-71-48"><a id="__codelineno-71-48" name="__codelineno-71-48" href="#__codelineno-71-48"></a><span class="c1"># config file settings</span>
</span><span id="__span-71-49"><a id="__codelineno-71-49" name="__codelineno-71-49" href="#__codelineno-71-49"></a>config:
</span><span id="__span-71-50"><a id="__codelineno-71-50" name="__codelineno-71-50" href="#__codelineno-71-50"></a><span class="w">  </span><span class="c1"># config file path</span>
</span><span id="__span-71-51"><a id="__codelineno-71-51" name="__codelineno-71-51" href="#__codelineno-71-51"></a><span class="w">  </span>path:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-52"><a id="__codelineno-71-52" name="__codelineno-71-52" href="#__codelineno-71-52"></a><span class="w">  </span><span class="c1"># config file name</span>
</span><span id="__span-71-53"><a id="__codelineno-71-53" name="__codelineno-71-53" href="#__codelineno-71-53"></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-54"><a id="__codelineno-71-54" name="__codelineno-71-54" href="#__codelineno-71-54"></a>
</span><span id="__span-71-55"><a id="__codelineno-71-55" name="__codelineno-71-55" href="#__codelineno-71-55"></a><span class="c1"># Additional command line arguments to pass to podinfo container</span>
</span><span id="__span-71-56"><a id="__codelineno-71-56" name="__codelineno-71-56" href="#__codelineno-71-56"></a>extraArgs:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-57"><a id="__codelineno-71-57" name="__codelineno-71-57" href="#__codelineno-71-57"></a>
</span><span id="__span-71-58"><a id="__codelineno-71-58" name="__codelineno-71-58" href="#__codelineno-71-58"></a><span class="c1"># enable tls on the podinfo service</span>
</span><span id="__span-71-59"><a id="__codelineno-71-59" name="__codelineno-71-59" href="#__codelineno-71-59"></a>tls:
</span><span id="__span-71-60"><a id="__codelineno-71-60" name="__codelineno-71-60" href="#__codelineno-71-60"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-61"><a id="__codelineno-71-61" name="__codelineno-71-61" href="#__codelineno-71-61"></a><span class="w">  </span><span class="c1"># the name of the secret used to mount the certificate key pair</span>
</span><span id="__span-71-62"><a id="__codelineno-71-62" name="__codelineno-71-62" href="#__codelineno-71-62"></a><span class="w">  </span>secretName:
</span><span id="__span-71-63"><a id="__codelineno-71-63" name="__codelineno-71-63" href="#__codelineno-71-63"></a><span class="w">  </span><span class="c1"># the path where the certificate key pair will be mounted</span>
</span><span id="__span-71-64"><a id="__codelineno-71-64" name="__codelineno-71-64" href="#__codelineno-71-64"></a><span class="w">  </span>certPath:<span class="w"> </span>/data/cert
</span><span id="__span-71-65"><a id="__codelineno-71-65" name="__codelineno-71-65" href="#__codelineno-71-65"></a><span class="w">  </span><span class="c1"># the port used to host the tls endpoint on the service</span>
</span><span id="__span-71-66"><a id="__codelineno-71-66" name="__codelineno-71-66" href="#__codelineno-71-66"></a><span class="w">  </span>port:<span class="w"> </span><span class="m">9899</span>
</span><span id="__span-71-67"><a id="__codelineno-71-67" name="__codelineno-71-67" href="#__codelineno-71-67"></a><span class="w">  </span><span class="c1"># the port used to bind the tls port to the host</span>
</span><span id="__span-71-68"><a id="__codelineno-71-68" name="__codelineno-71-68" href="#__codelineno-71-68"></a><span class="w">  </span><span class="c1"># NOTE: requires privileged container with NET_BIND_SERVICE capability -- this is useful for testing</span>
</span><span id="__span-71-69"><a id="__codelineno-71-69" name="__codelineno-71-69" href="#__codelineno-71-69"></a><span class="w">  </span><span class="c1"># in local clusters such as kind without port forwarding</span>
</span><span id="__span-71-70"><a id="__codelineno-71-70" name="__codelineno-71-70" href="#__codelineno-71-70"></a><span class="w">  </span>hostPort:
</span><span id="__span-71-71"><a id="__codelineno-71-71" name="__codelineno-71-71" href="#__codelineno-71-71"></a>
</span><span id="__span-71-72"><a id="__codelineno-71-72" name="__codelineno-71-72" href="#__codelineno-71-72"></a><span class="c1"># create a certificate manager certificate (cert-manager required)</span>
</span><span id="__span-71-73"><a id="__codelineno-71-73" name="__codelineno-71-73" href="#__codelineno-71-73"></a>certificate:
</span><span id="__span-71-74"><a id="__codelineno-71-74" name="__codelineno-71-74" href="#__codelineno-71-74"></a><span class="w">  </span>create:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-75"><a id="__codelineno-71-75" name="__codelineno-71-75" href="#__codelineno-71-75"></a><span class="w">  </span><span class="c1"># the issuer used to issue the certificate</span>
</span><span id="__span-71-76"><a id="__codelineno-71-76" name="__codelineno-71-76" href="#__codelineno-71-76"></a><span class="w">  </span>issuerRef:
</span><span id="__span-71-77"><a id="__codelineno-71-77" name="__codelineno-71-77" href="#__codelineno-71-77"></a><span class="w">    </span>kind:<span class="w"> </span>ClusterIssuer
</span><span id="__span-71-78"><a id="__codelineno-71-78" name="__codelineno-71-78" href="#__codelineno-71-78"></a><span class="w">    </span>name:<span class="w"> </span>self-signed
</span><span id="__span-71-79"><a id="__codelineno-71-79" name="__codelineno-71-79" href="#__codelineno-71-79"></a><span class="w">  </span><span class="c1"># the hostname / subject alternative names for the certificate</span>
</span><span id="__span-71-80"><a id="__codelineno-71-80" name="__codelineno-71-80" href="#__codelineno-71-80"></a><span class="w">  </span>dnsNames:
</span><span id="__span-71-81"><a id="__codelineno-71-81" name="__codelineno-71-81" href="#__codelineno-71-81"></a><span class="w">    </span>-<span class="w"> </span>podinfo
</span><span id="__span-71-82"><a id="__codelineno-71-82" name="__codelineno-71-82" href="#__codelineno-71-82"></a>
</span><span id="__span-71-83"><a id="__codelineno-71-83" name="__codelineno-71-83" href="#__codelineno-71-83"></a><span class="c1"># metrics-server add-on required</span>
</span><span id="__span-71-84"><a id="__codelineno-71-84" name="__codelineno-71-84" href="#__codelineno-71-84"></a>hpa:
</span><span id="__span-71-85"><a id="__codelineno-71-85" name="__codelineno-71-85" href="#__codelineno-71-85"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-86"><a id="__codelineno-71-86" name="__codelineno-71-86" href="#__codelineno-71-86"></a><span class="w">  </span>maxReplicas:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-71-87"><a id="__codelineno-71-87" name="__codelineno-71-87" href="#__codelineno-71-87"></a><span class="w">  </span><span class="c1"># average total CPU usage per pod (1-100)</span>
</span><span id="__span-71-88"><a id="__codelineno-71-88" name="__codelineno-71-88" href="#__codelineno-71-88"></a><span class="w">  </span>cpu:
</span><span id="__span-71-89"><a id="__codelineno-71-89" name="__codelineno-71-89" href="#__codelineno-71-89"></a><span class="w">  </span><span class="c1"># average memory usage per pod (100Mi-1Gi)</span>
</span><span id="__span-71-90"><a id="__codelineno-71-90" name="__codelineno-71-90" href="#__codelineno-71-90"></a><span class="w">  </span>memory:
</span><span id="__span-71-91"><a id="__codelineno-71-91" name="__codelineno-71-91" href="#__codelineno-71-91"></a><span class="w">  </span><span class="c1"># average http requests per second per pod (k8s-prometheus-adapter)</span>
</span><span id="__span-71-92"><a id="__codelineno-71-92" name="__codelineno-71-92" href="#__codelineno-71-92"></a><span class="w">  </span>requests:
</span><span id="__span-71-93"><a id="__codelineno-71-93" name="__codelineno-71-93" href="#__codelineno-71-93"></a>
</span><span id="__span-71-94"><a id="__codelineno-71-94" name="__codelineno-71-94" href="#__codelineno-71-94"></a><span class="c1"># Redis address in the format tcp://&lt;host&gt;:&lt;port&gt;</span>
</span><span id="__span-71-95"><a id="__codelineno-71-95" name="__codelineno-71-95" href="#__codelineno-71-95"></a>cache:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-96"><a id="__codelineno-71-96" name="__codelineno-71-96" href="#__codelineno-71-96"></a><span class="c1"># Redis deployment</span>
</span><span id="__span-71-97"><a id="__codelineno-71-97" name="__codelineno-71-97" href="#__codelineno-71-97"></a>redis:
</span><span id="__span-71-98"><a id="__codelineno-71-98" name="__codelineno-71-98" href="#__codelineno-71-98"></a>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-99"><a id="__codelineno-71-99" name="__codelineno-71-99" href="#__codelineno-71-99"></a>repository:<span class="w"> </span>redis
</span><span id="__span-71-100"><a id="__codelineno-71-100" name="__codelineno-71-100" href="#__codelineno-71-100"></a>tag:<span class="w"> </span><span class="m">7</span>.0.7
</span><span id="__span-71-101"><a id="__codelineno-71-101" name="__codelineno-71-101" href="#__codelineno-71-101"></a>
</span><span id="__span-71-102"><a id="__codelineno-71-102" name="__codelineno-71-102" href="#__codelineno-71-102"></a>serviceAccount:
</span><span id="__span-71-103"><a id="__codelineno-71-103" name="__codelineno-71-103" href="#__codelineno-71-103"></a><span class="w">  </span><span class="c1"># Specifies whether a service account should be created</span>
</span><span id="__span-71-104"><a id="__codelineno-71-104" name="__codelineno-71-104" href="#__codelineno-71-104"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-105"><a id="__codelineno-71-105" name="__codelineno-71-105" href="#__codelineno-71-105"></a><span class="w">  </span><span class="c1"># The name of the service account to use.</span>
</span><span id="__span-71-106"><a id="__codelineno-71-106" name="__codelineno-71-106" href="#__codelineno-71-106"></a><span class="w">  </span><span class="c1"># If not set and create is true, a name is generated using the fullname template</span>
</span><span id="__span-71-107"><a id="__codelineno-71-107" name="__codelineno-71-107" href="#__codelineno-71-107"></a><span class="w">  </span>name:
</span><span id="__span-71-108"><a id="__codelineno-71-108" name="__codelineno-71-108" href="#__codelineno-71-108"></a><span class="w">  </span><span class="c1"># List of image pull secrets if pulling from private registries</span>
</span><span id="__span-71-109"><a id="__codelineno-71-109" name="__codelineno-71-109" href="#__codelineno-71-109"></a><span class="w">  </span>imagePullSecrets:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-110"><a id="__codelineno-71-110" name="__codelineno-71-110" href="#__codelineno-71-110"></a>
</span><span id="__span-71-111"><a id="__codelineno-71-111" name="__codelineno-71-111" href="#__codelineno-71-111"></a><span class="c1"># set container security context</span>
</span><span id="__span-71-112"><a id="__codelineno-71-112" name="__codelineno-71-112" href="#__codelineno-71-112"></a>securityContext:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-113"><a id="__codelineno-71-113" name="__codelineno-71-113" href="#__codelineno-71-113"></a>
</span><span id="__span-71-114"><a id="__codelineno-71-114" name="__codelineno-71-114" href="#__codelineno-71-114"></a><span class="c1"># set pod security context</span>
</span><span id="__span-71-115"><a id="__codelineno-71-115" name="__codelineno-71-115" href="#__codelineno-71-115"></a>podSecurityContext:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-116"><a id="__codelineno-71-116" name="__codelineno-71-116" href="#__codelineno-71-116"></a>
</span><span id="__span-71-117"><a id="__codelineno-71-117" name="__codelineno-71-117" href="#__codelineno-71-117"></a>ingress:
</span><span id="__span-71-118"><a id="__codelineno-71-118" name="__codelineno-71-118" href="#__codelineno-71-118"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-119"><a id="__codelineno-71-119" name="__codelineno-71-119" href="#__codelineno-71-119"></a><span class="w">  </span>className:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-71-120"><a id="__codelineno-71-120" name="__codelineno-71-120" href="#__codelineno-71-120"></a><span class="w">  </span>additionalLabels:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-121"><a id="__codelineno-71-121" name="__codelineno-71-121" href="#__codelineno-71-121"></a><span class="w">  </span>annotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-122"><a id="__codelineno-71-122" name="__codelineno-71-122" href="#__codelineno-71-122"></a><span class="w">    </span><span class="c1"># kubernetes.io/ingress.class: nginx</span>
</span><span id="__span-71-123"><a id="__codelineno-71-123" name="__codelineno-71-123" href="#__codelineno-71-123"></a><span class="w">    </span><span class="c1"># kubernetes.io/tls-acme: &quot;true&quot;</span>
</span><span id="__span-71-124"><a id="__codelineno-71-124" name="__codelineno-71-124" href="#__codelineno-71-124"></a><span class="w">  </span>hosts:
</span><span id="__span-71-125"><a id="__codelineno-71-125" name="__codelineno-71-125" href="#__codelineno-71-125"></a><span class="w">    </span>-<span class="w"> </span>host:<span class="w"> </span>podinfo.local
</span><span id="__span-71-126"><a id="__codelineno-71-126" name="__codelineno-71-126" href="#__codelineno-71-126"></a><span class="w">      </span>paths:
</span><span id="__span-71-127"><a id="__codelineno-71-127" name="__codelineno-71-127" href="#__codelineno-71-127"></a><span class="w">        </span>-<span class="w"> </span>path:<span class="w"> </span>/
</span><span id="__span-71-128"><a id="__codelineno-71-128" name="__codelineno-71-128" href="#__codelineno-71-128"></a><span class="w">          </span>pathType:<span class="w"> </span>ImplementationSpecific
</span><span id="__span-71-129"><a id="__codelineno-71-129" name="__codelineno-71-129" href="#__codelineno-71-129"></a><span class="w">  </span>tls:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-130"><a id="__codelineno-71-130" name="__codelineno-71-130" href="#__codelineno-71-130"></a><span class="w">  </span><span class="c1">#  - secretName: chart-example-tls</span>
</span><span id="__span-71-131"><a id="__codelineno-71-131" name="__codelineno-71-131" href="#__codelineno-71-131"></a><span class="w">  </span><span class="c1">#    hosts:</span>
</span><span id="__span-71-132"><a id="__codelineno-71-132" name="__codelineno-71-132" href="#__codelineno-71-132"></a><span class="w">  </span><span class="c1">#      - chart-example.local</span>
</span><span id="__span-71-133"><a id="__codelineno-71-133" name="__codelineno-71-133" href="#__codelineno-71-133"></a>
</span><span id="__span-71-134"><a id="__codelineno-71-134" name="__codelineno-71-134" href="#__codelineno-71-134"></a>linkerd:
</span><span id="__span-71-135"><a id="__codelineno-71-135" name="__codelineno-71-135" href="#__codelineno-71-135"></a><span class="w">  </span>profile:
</span><span id="__span-71-136"><a id="__codelineno-71-136" name="__codelineno-71-136" href="#__codelineno-71-136"></a><span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-137"><a id="__codelineno-71-137" name="__codelineno-71-137" href="#__codelineno-71-137"></a>
</span><span id="__span-71-138"><a id="__codelineno-71-138" name="__codelineno-71-138" href="#__codelineno-71-138"></a><span class="c1"># create Prometheus Operator monitor</span>
</span><span id="__span-71-139"><a id="__codelineno-71-139" name="__codelineno-71-139" href="#__codelineno-71-139"></a>serviceMonitor:
</span><span id="__span-71-140"><a id="__codelineno-71-140" name="__codelineno-71-140" href="#__codelineno-71-140"></a><span class="w">  </span>enabled:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-141"><a id="__codelineno-71-141" name="__codelineno-71-141" href="#__codelineno-71-141"></a><span class="w">  </span>interval:<span class="w"> </span>15s
</span><span id="__span-71-142"><a id="__codelineno-71-142" name="__codelineno-71-142" href="#__codelineno-71-142"></a><span class="w">  </span>additionalLabels:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-143"><a id="__codelineno-71-143" name="__codelineno-71-143" href="#__codelineno-71-143"></a>
</span><span id="__span-71-144"><a id="__codelineno-71-144" name="__codelineno-71-144" href="#__codelineno-71-144"></a>resources:
</span><span id="__span-71-145"><a id="__codelineno-71-145" name="__codelineno-71-145" href="#__codelineno-71-145"></a><span class="w">  </span>limits:
</span><span id="__span-71-146"><a id="__codelineno-71-146" name="__codelineno-71-146" href="#__codelineno-71-146"></a><span class="w">  </span>requests:
</span><span id="__span-71-147"><a id="__codelineno-71-147" name="__codelineno-71-147" href="#__codelineno-71-147"></a><span class="w">    </span>cpu:<span class="w"> </span>1m
</span><span id="__span-71-148"><a id="__codelineno-71-148" name="__codelineno-71-148" href="#__codelineno-71-148"></a><span class="w">    </span>memory:<span class="w"> </span>16Mi
</span><span id="__span-71-149"><a id="__codelineno-71-149" name="__codelineno-71-149" href="#__codelineno-71-149"></a>
</span><span id="__span-71-150"><a id="__codelineno-71-150" name="__codelineno-71-150" href="#__codelineno-71-150"></a><span class="c1"># Extra environment variables for the podinfo container</span>
</span><span id="__span-71-151"><a id="__codelineno-71-151" name="__codelineno-71-151" href="#__codelineno-71-151"></a>extraEnvs:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-152"><a id="__codelineno-71-152" name="__codelineno-71-152" href="#__codelineno-71-152"></a><span class="c1"># Example on how to configure extraEnvs</span>
</span><span id="__span-71-153"><a id="__codelineno-71-153" name="__codelineno-71-153" href="#__codelineno-71-153"></a><span class="c1">#  - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</span>
</span><span id="__span-71-154"><a id="__codelineno-71-154" name="__codelineno-71-154" href="#__codelineno-71-154"></a><span class="c1">#    value: &quot;http://otel:4317&quot;</span>
</span><span id="__span-71-155"><a id="__codelineno-71-155" name="__codelineno-71-155" href="#__codelineno-71-155"></a><span class="c1">#  - name: MULTIPLE_VALUES</span>
</span><span id="__span-71-156"><a id="__codelineno-71-156" name="__codelineno-71-156" href="#__codelineno-71-156"></a><span class="c1">#    value: TEST</span>
</span><span id="__span-71-157"><a id="__codelineno-71-157" name="__codelineno-71-157" href="#__codelineno-71-157"></a>
</span><span id="__span-71-158"><a id="__codelineno-71-158" name="__codelineno-71-158" href="#__codelineno-71-158"></a>nodeSelector:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-159"><a id="__codelineno-71-159" name="__codelineno-71-159" href="#__codelineno-71-159"></a>
</span><span id="__span-71-160"><a id="__codelineno-71-160" name="__codelineno-71-160" href="#__codelineno-71-160"></a>tolerations:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-161"><a id="__codelineno-71-161" name="__codelineno-71-161" href="#__codelineno-71-161"></a>
</span><span id="__span-71-162"><a id="__codelineno-71-162" name="__codelineno-71-162" href="#__codelineno-71-162"></a>affinity:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-163"><a id="__codelineno-71-163" name="__codelineno-71-163" href="#__codelineno-71-163"></a>
</span><span id="__span-71-164"><a id="__codelineno-71-164" name="__codelineno-71-164" href="#__codelineno-71-164"></a>podAnnotations:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-165"><a id="__codelineno-71-165" name="__codelineno-71-165" href="#__codelineno-71-165"></a>
</span><span id="__span-71-166"><a id="__codelineno-71-166" name="__codelineno-71-166" href="#__codelineno-71-166"></a><span class="c1"># https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/</span>
</span><span id="__span-71-167"><a id="__codelineno-71-167" name="__codelineno-71-167" href="#__codelineno-71-167"></a>topologySpreadConstraints:<span class="w"> </span><span class="o">[]</span>
</span><span id="__span-71-168"><a id="__codelineno-71-168" name="__codelineno-71-168" href="#__codelineno-71-168"></a>
</span><span id="__span-71-169"><a id="__codelineno-71-169" name="__codelineno-71-169" href="#__codelineno-71-169"></a><span class="c1"># Disruption budget will be configured only when the replicaCount is greater than 1</span>
</span><span id="__span-71-170"><a id="__codelineno-71-170" name="__codelineno-71-170" href="#__codelineno-71-170"></a>podDisruptionBudget:<span class="w"> </span><span class="o">{}</span>
</span><span id="__span-71-171"><a id="__codelineno-71-171" name="__codelineno-71-171" href="#__codelineno-71-171"></a><span class="c1">#  maxUnavailable: 1</span>
</span><span id="__span-71-172"><a id="__codelineno-71-172" name="__codelineno-71-172" href="#__codelineno-71-172"></a>
</span><span id="__span-71-173"><a id="__codelineno-71-173" name="__codelineno-71-173" href="#__codelineno-71-173"></a><span class="c1"># https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#container-probes</span>
</span><span id="__span-71-174"><a id="__codelineno-71-174" name="__codelineno-71-174" href="#__codelineno-71-174"></a>probes:
</span><span id="__span-71-175"><a id="__codelineno-71-175" name="__codelineno-71-175" href="#__codelineno-71-175"></a><span class="w">  </span>readiness:
</span><span id="__span-71-176"><a id="__codelineno-71-176" name="__codelineno-71-176" href="#__codelineno-71-176"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-177"><a id="__codelineno-71-177" name="__codelineno-71-177" href="#__codelineno-71-177"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-71-178"><a id="__codelineno-71-178" name="__codelineno-71-178" href="#__codelineno-71-178"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-71-179"><a id="__codelineno-71-179" name="__codelineno-71-179" href="#__codelineno-71-179"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-180"><a id="__codelineno-71-180" name="__codelineno-71-180" href="#__codelineno-71-180"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-71-181"><a id="__codelineno-71-181" name="__codelineno-71-181" href="#__codelineno-71-181"></a><span class="w">  </span>liveness:
</span><span id="__span-71-182"><a id="__codelineno-71-182" name="__codelineno-71-182" href="#__codelineno-71-182"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-183"><a id="__codelineno-71-183" name="__codelineno-71-183" href="#__codelineno-71-183"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-71-184"><a id="__codelineno-71-184" name="__codelineno-71-184" href="#__codelineno-71-184"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-71-185"><a id="__codelineno-71-185" name="__codelineno-71-185" href="#__codelineno-71-185"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-186"><a id="__codelineno-71-186" name="__codelineno-71-186" href="#__codelineno-71-186"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-71-187"><a id="__codelineno-71-187" name="__codelineno-71-187" href="#__codelineno-71-187"></a><span class="w">  </span>startup:
</span><span id="__span-71-188"><a id="__codelineno-71-188" name="__codelineno-71-188" href="#__codelineno-71-188"></a><span class="w">    </span>enable:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-71-189"><a id="__codelineno-71-189" name="__codelineno-71-189" href="#__codelineno-71-189"></a><span class="w">    </span>initialDelaySeconds:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-71-190"><a id="__codelineno-71-190" name="__codelineno-71-190" href="#__codelineno-71-190"></a><span class="w">    </span>timeoutSeconds:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-71-191"><a id="__codelineno-71-191" name="__codelineno-71-191" href="#__codelineno-71-191"></a><span class="w">    </span>failureThreshold:<span class="w"> </span><span class="m">20</span>
</span><span id="__span-71-192"><a id="__codelineno-71-192" name="__codelineno-71-192" href="#__codelineno-71-192"></a><span class="w">    </span>successThreshold:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-71-193"><a id="__codelineno-71-193" name="__codelineno-71-193" href="#__codelineno-71-193"></a><span class="w">    </span>periodSeconds:<span class="w"> </span><span class="m">10</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Il est Ã©galement possible de consulter les '<em>default values</em>' directement sur le site <strong>artifacthub.io</strong> :</p>
<p><a href="https://artifacthub.io/packages/helm/podinfo/podinfo?modal=values">https://artifacthub.io/packages/helm/podinfo/podinfo?modal=values</a></p>
</div>
<p>Par exemple, souhaitons apporter un peu plus de rÃ©silience Ã  l'application en exÃ©cutant 2 ReplicaSets plutÃ´t qu'un. Nous souhaitons Ã©galement gÃ©rer finement les ressources de l'application, et changer le message d'accueil de la UI.</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://github.com/stefanprodan/podinfo?tab=readme-ov-file#continuous-delivery">https://github.com/stefanprodan/podinfo?tab=readme-ov-file#continuous-delivery</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nous Ã©crirons les '<em>values</em>' que nous souhaitons surcharger aux '<em>default values</em>' dans une <em>ConfigMap</em> Kubernetes.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="32:2"><input checked="checked" id="__tabbed_32_1" name="__tabbed_32" type="radio" /><input id="__tabbed_32_2" name="__tabbed_32" type="radio" /><div class="tabbed-labels"><label for="__tabbed_32_1">code</label><label for="__tabbed_32_2">podinfo-values.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>mkdir<span class="w"> </span>podinfo
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="c1"># CrÃ©ation d&#39;un fichier temporaire &#39;values.yaml&#39; contenant les paramÃ¨tres Ã  surcharger :</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; values.yaml</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="s">replicaCount: 2</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="s">resources:</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="s">  limits:</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="s">    memory: 256Mi</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="s">  requests:</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="s">    cpu: 100m</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="s">    memory: 64Mi</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="s">ui:</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="s">  message: &quot;Hello from PodInfo ! ^^&quot;  </span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="s">EOF</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="c1"># CrÃ©ation de la ConfigMap Ã  partir du fichier &#39;values.yaml&#39; :</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>podinfo-values<span class="w"> </span><span class="se">\</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a><span class="w">  </span>--from-file<span class="o">=</span>values.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a><span class="w">  </span>--dry-run<span class="o">=</span>client<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>podinfo/podinfo.values.yaml
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a><span class="c1"># Suppression du fichier &#39;values.yaml&#39; :</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a>/bin/rm<span class="w"> </span>values.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>data:
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">  </span>values.yaml:<span class="w"> </span><span class="p">|</span>+
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span>replicaCount:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">    </span>resources:
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">      </span>limits:
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">        </span>memory:<span class="w"> </span>256Mi
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">      </span>requests:
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="w">        </span>cpu:<span class="w"> </span>100m
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="w">        </span>memory:<span class="w"> </span>64Mi
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="w">    </span>ui:
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="w">      </span>message:<span class="w"> </span><span class="s2">&quot;Hello from PodInfo ! ^^&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h5 id="definition-de-la-helmrelease">DÃ©finition de la HelmRelease</h5>
<p>DÃ©finissons maintenant la HelmRelease :</p>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/cmd/flux_create_helmrelease/">https://fluxcd.io/flux/cmd/flux_create_helmrelease/</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Au moment de la rÃ©daction de ce HOWTO, la derniÃ¨re version de '<em>podinfo</em>' Ã©tait la 6.9.2. Nous choisissons ici de limiter notre '<em>Helm Release</em>' Ã  la version 5 (<code>--chart-version="&lt;6.0.0"</code>), pour tester ensuite les notifications via un service de messagerie instantanÃ©e que nous allons trÃ¨s vite mettre en place.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="33:2"><input checked="checked" id="__tabbed_33_1" name="__tabbed_33" type="radio" /><input id="__tabbed_33_2" name="__tabbed_33" type="radio" /><div class="tabbed-labels"><label for="__tabbed_33_1">code</label><label for="__tabbed_33_2">podinfo HelmRelease</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>flux<span class="w"> </span>create<span class="w"> </span>helmrelease<span class="w"> </span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="w">  </span>--source<span class="o">=</span>HelmRepository/podinfo.podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">  </span>--chart<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">  </span>--chart-version<span class="o">=</span><span class="s2">&quot;&lt;6.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">  </span>--values-from<span class="o">=</span>ConfigMap/podinfo-values<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">  </span>--interval<span class="o">=</span>10m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>podinfo/podinfo.helmrelease.yaml
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Defined podinfo HelmRelease with custom values as a ConfigMap.&#39;</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>git<span class="w"> </span>push
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>---
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>apiVersion:<span class="w"> </span>helm.toolkit.fluxcd.io/v2
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>kind:<span class="w"> </span>HelmRelease
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>metadata:
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">  </span>name:<span class="w"> </span>podinfo
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>spec:
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">  </span>chart:
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="w">    </span>spec:
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">      </span>chart:<span class="w"> </span>podinfo
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">      </span>reconcileStrategy:<span class="w"> </span>ChartVersion
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">      </span>sourceRef:
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">        </span>kind:<span class="w"> </span>HelmRepository
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="w">        </span>name:<span class="w"> </span>podinfo
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="w">        </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="w">  </span>interval:<span class="w"> </span>10m
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="w">  </span>valuesFrom:
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ConfigMap
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a><span class="w">    </span>name:<span class="w"> </span>podinfo-values
</span></code></pre></div>
</div>
</div>
</div>
<p>Regardons si la magie opÃ¨re :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="34:2"><input checked="checked" id="__tabbed_34_1" name="__tabbed_34" type="radio" /><input id="__tabbed_34_2" name="__tabbed_34" type="radio" /><div class="tabbed-labels"><label for="__tabbed_34_1">code</label><label for="__tabbed_34_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>kustomization,helmrelease
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>NAME<span class="w">                                                </span>AGE<span class="w">   </span>READY<span class="w">   </span>STATUS
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>kustomization.kustomize.toolkit.fluxcd.io/podinfo<span class="w">   </span>29m<span class="w">   </span>True<span class="w">    </span>Applied<span class="w"> </span>revision:<span class="w"> </span>main@sha1:36cdfa300f5d4ad6787264956be13816ab683800
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>NAME<span class="w">                                         </span>AGE<span class="w">   </span>READY<span class="w">   </span>STATUS
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>helmrelease.helm.toolkit.fluxcd.io/podinfo<span class="w">   </span>65s<span class="w">   </span>True<span class="w">    </span>Helm<span class="w"> </span>install<span class="w"> </span>succeeded<span class="w"> </span><span class="k">for</span><span class="w"> </span>release<span class="w"> </span>podinfo/podinfo.v1<span class="w"> </span>with<span class="w"> </span>chart<span class="w"> </span>podinfo@5.2.1<span class="w"> </span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Bonne nouvelle : notre '<em>kustomization</em>' est dÃ©sormais dans l'Ã©tat attendu !</p>
<p>Par ailleurs, notre '<em>HelmRelease</em>' nouvellement dÃ©finie semble elle-aussi dÃ©ployÃ©e avec succÃ¨s et Ã  une version infÃ©rieure Ã  6.</p>
<p>VÃ©rifions si l'application est bel et bien dÃ©ployÃ©e :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="35:2"><input checked="checked" id="__tabbed_35_1" name="__tabbed_35" type="radio" /><input id="__tabbed_35_2" name="__tabbed_35" type="radio" /><div class="tabbed-labels"><label for="__tabbed_35_1">code</label><label for="__tabbed_35_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>all
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>NAME<span class="w">                          </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>pod/podinfo-db75857bd-7z9vw<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>5m43s
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>pod/podinfo-db75857bd-n6mt6<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>5m43s
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>NAME<span class="w">              </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">    </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">             </span>AGE
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>service/podinfo<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.43.60.99<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">9898</span>/TCP,9999/TCP<span class="w">   </span>5m43s
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>NAME<span class="w">                      </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>deployment.apps/podinfo<span class="w">   </span><span class="m">2</span>/2<span class="w">     </span><span class="m">2</span><span class="w">            </span><span class="m">2</span><span class="w">           </span>5m43s
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a>NAME<span class="w">                                </span>DESIRED<span class="w">   </span>CURRENT<span class="w">   </span>READY<span class="w">   </span>AGE
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>replicaset.apps/podinfo-db75857bd<span class="w">   </span><span class="m">2</span><span class="w">         </span><span class="m">2</span><span class="w">         </span><span class="m">2</span><span class="w">       </span>5m43s
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous observons 2 <em>Replicasets</em> comme nous l'avons demandÃ© dans nos '<em>custom values</em>'.</p>
<p>Utilisons la redirection de ports pour accÃ©der Ã  l'application avec un navigateur :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="36:1"><input checked="checked" id="__tabbed_36_1" name="__tabbed_36" type="radio" /><div class="tabbed-labels"><label for="__tabbed_36_1">code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>port-forward<span class="w"> </span>service/podinfo<span class="w"> </span><span class="m">9898</span>:9898
</span></code></pre></div>
</div>
</div>
</div>
<p><img alt="podinfo" src="../images/podinfo.png" />
Nous voyons bien notre message d'accueil personnalisÃ© : '<strong>Hello PodInfo! ^^</strong>'.</p>
<hr />
<h2 id="notifications-discord">Notifications Discord</h2>
<p>Nous avons configurÃ© FluxCD pour gÃ©rer automatiquement la mise Ã  jour de nos applications <em><em>'agnhost'</em></em> et <em><em>'podinfo'</em></em>.</p>
<p>Nous aimerions maintenant Ãªtre alertÃ©s lorsqu'un changement affecte nos applications. PlutÃ´t qu'une messagerie mail classique, nous privilÃ©gions une messagerie instantanÃ©e. Notre choix s'est portÃ© sur la plateforme <strong>'Discord'</strong> car elle permet de configurer des <em><em>'webhooks'</em></em> sur des <em><em>'channels'</em></em> sans pour autant devoir payer un abonnement, comme ce serait le cas avec <strong>Slack</strong>.</p>
<h3 id="installation-et-configuration-du-client-discord">Installation et configuration du client '<em>Discord</em>'</h3>
<h4 id="installation-du-client-discord">Installation du client <em><em>'Discord'</em></em></h4>
<p>Pour l'installer, il faut accÃ©der au site web <strong>discord.com</strong> et tÃ©lÃ©charger le client :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>https://discord.com/api/download?platform<span class="o">=</span>osx
</span></code></pre></div>
<h4 id="creation-dun-serveur-discord">CrÃ©ation d'un serveur Discord</h4>
<p>Discord permet la crÃ©ation de <em><em>'serveurs'</em></em> que nous pouvons restreindre pour notre usage personnel et qui hÃ©bergeront les <em><em>'salons'</em></em> (ou '<em>rooms</em>') que nous dÃ©dierons Ã  l'envoi de notifications de FluxCD concernant nos applications.</p>
<p>Une fois le client Discord dÃ©marrÃ©, cliquons sur le <strong>'+'</strong> situÃ© dans la colonne de gauche. Nous rÃ©pondrons ensuite aux diffÃ©rentes questions et donnerons Ã  notre serveur le nom de notre cluster Kubernetes : <strong>k8s-kind</strong>.</p>
<p><img alt="Add a Discord server #1" src="../images/discord_add_server_1.png" /></p>
<p><img alt="Add a Discord server #2" src="../images/discord_add_server_2.png" /></p>
<p><img alt="Add a Discord server #3" src="../images/discord_add_server_3.png" /></p>
<p><img alt="Add a Discord server #4" src="../images/discord_add_server_4.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>J'ai choisi l'<a href="https://www.redhat.com/rhdc/managed-files/ohc/logo_with_border.png">icÃ´ne de '<em>Kubernetes</em>'</a> pour mon serveur Discord que j'ai nommÃ© '<em>k8s</em>'.</p>
</div>
<h4 id="creation-dun-channel-dans-notre-serveur-discord">CrÃ©ation d'un <em>channel</em> dans notre serveur <em>Discord</em></h4>
<p>Nous souhaitons crÃ©er un <em>channel</em> pour chacune de nos applications. La procÃ©dure Ã©tant la mÃªme, nous montrerons la crÃ©ation du salon pour l'application <em><em>'agnhost'</em></em>. Vous devrez faire la mÃªme chose pour les autres applications.</p>
<p>SÃ©lectionnez le serveur <em><em>'k8s-kind'</em></em> dans la colonne de gauche, puis dans la partie 'salons textuels', cliquez sur le <strong>'+'</strong> :</p>
<p><img alt="Add a Discord channel #1" src="../images/discord_add_channel_1.png" /></p>
<p>PrÃ©cisez qu'il s'agit bien d'un salon textuel, prÃ©cisez son nom <em><em>'foo'</em></em> et choisissez de le rendre <strong>privÃ©</strong> :</p>
<p><img alt="Add a Discord channel #2" src="../images/discord_add_channel_2.png" /></p>
<p>Passez l'Ã©tape d'ajout de membres :</p>
<p><img alt="Add a Discord channel 3" src="../images/discord_add_channel_3.png" /></p>
<p>Votre <em>channel</em> 'agnhost' est prÃªt. Il vous reste Ã  crÃ©er le <em>channel</em> 'podinfo'.</p>
<p><img alt="Add a second Discord channel" src="../images/discord_add_second_channel.png" /></p>
<h4 id="creation-dun-webhook-pour-chaque-salon">CrÃ©ation d'un <em><em>'webhook'</em></em> pour chaque salon</h4>
<p>Cliquez sur la roue dentÃ©e <em>'paramÃ¨tres'</em> Ã  droite du nom du salon, puis sur <em>'intÃ©grations'</em> et enfin sur le bouton <em>'CrÃ©er un webhook'</em>.</p>
<p><img alt="Configure a webhook #1" src="../images/discord_configure_webhook_1.png" /></p>
<p><img alt="Configure a webhook #2" src="../images/discord_configure_webhook_2.png" /></p>
<p><img alt="Configure a webhook #3" src="./images/discord_configure_webhook_3.png" /></p>
<p>Un nom lui est donnÃ© de maniÃ¨re alÃ©atoire (ex: 'Spidey Bot'). Pour changer le nom du <em>'webhook'</em> par 'FluxCD', copiez l'URL en cliquant sur le bouton idoine, et enregistrez les modifications :</p>
<p><img alt="Configure a webhook #4" src="../images/discord_configure_webhook_4.png" /></p>
<p><img alt="Configure a webhook #5" src="../images/discord_configure_webhook_5.png" /></p>
<p><strong>Nous rÃ©pÃ©tons les mÃªmes opÃ©rations pour la crÃ©ation du '<em>channel</em>' _'<em>podinfo</em>'_.</strong></p>
<p>Les URLs des webhooks des salons sont les suivants :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Channel</th>
<th>Webhook URL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>agnhost</strong></td>
<td>https://discord.com/api/webhooks/1424064102791123036/JDExJGHiqCP9qcJiybnBhe8MTT_mu8lFlLM6QdYBh0RJ-5E4QUa4aGDflMjRATJwQq57</td>
</tr>
<tr>
<td style="text-align: center;"><strong>podinfo</strong></td>
<td>https://discord.com/api/webhooks/1424065205444415508/xEeNJVhhRpyu_mFOMWyYLJMuNhQjgr3tKPJYzs5eUHYYiNWnYgh_hMuZIABkJw8syPl4</td>
</tr>
</tbody>
</table>
<h3 id="creation-dun-secret-pour-chaque-webhook">CrÃ©ation d'un <em>secret</em> pour chaque <em>webhook</em></h3>
<p>Ces informations sont considÃ©rÃ©es comme sensibles dans la mesure oÃ¹ quiconque en disposerait pourrait publier des informations dans nos <em>channels</em> privÃ©s. Nous les enregistrerons dans Kubernetes comme des <em>'secrets'</em>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="37:3"><input checked="checked" id="__tabbed_37_1" name="__tabbed_37" type="radio" /><input id="__tabbed_37_2" name="__tabbed_37" type="radio" /><input id="__tabbed_37_3" name="__tabbed_37" type="radio" /><div class="tabbed-labels"><label for="__tabbed_37_1">code</label><label for="__tabbed_37_2">webhook 'agnhost'</label><label for="__tabbed_37_3">webhook 'podinfo'</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">WEBHOOK_AGNHOST</span><span class="o">=</span><span class="s2">&quot;https://discord.com/api/webhooks/1424064102791123036/JDExJGHiqCP9qcJiybnBhe8MTT_mu8lFlLM6QdYBh0RJ-5E4QUa4aGDflMjRATJwQq57&quot;</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">WEBHOOK_PODINFO</span><span class="o">=</span><span class="s2">&quot;https://discord.com/api/webhooks/1424065205444415508/xEeNJVhhRpyu_mFOMWyYLJMuNhQjgr3tKPJYzs5eUHYYiNWnYgh_hMuZIABkJw8syPl4&quot;</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>discord-webhook<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">address</span><span class="o">=</span><span class="si">${</span><span class="nv">WEBHOOK_AGNHOST</span><span class="si">}</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>discord-webhook<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">address</span><span class="o">=</span><span class="si">${</span><span class="nv">WEBHOOK_PODINFO</span><span class="si">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>data:
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">  </span>address:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>kind:<span class="w"> </span>Secret
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>metadata:
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-10-04T16:12:57Z&quot;</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w">  </span>name:<span class="w"> </span>discord-webhook
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">  </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;392125&quot;</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">  </span>uid:<span class="w"> </span>3959e6fd-1d9
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>data:
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">  </span>address:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>kind:<span class="w"> </span>Secret
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>metadata:
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-10-04T16:13:03Z&quot;</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">  </span>name:<span class="w"> </span>discord-webhook
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">  </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;392141&quot;</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">  </span>uid:<span class="w"> </span>ef9c6856-c629-46ca-9cfd-6bd7ce8865e3
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>â¡type:<span class="w"> </span>Opaque
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="definition-des-notification-providers">DÃ©finition des <em>'<em>notification providers</em>'</em></h3>
<div class="admonition doc">
<p class="admonition-title">Doc</p>
<p><a href="https://fluxcd.io/flux/components/notification/providers/#discord">https://fluxcd.io/flux/components/notification/providers/#discord</a></p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="38:3"><input checked="checked" id="__tabbed_38_1" name="__tabbed_38" type="radio" /><input id="__tabbed_38_2" name="__tabbed_38" type="radio" /><input id="__tabbed_38_3" name="__tabbed_38" type="radio" /><div class="tabbed-labels"><label for="__tabbed_38_1">code</label><label for="__tabbed_38_2">agnhost</label><label for="__tabbed_38_3">podinfo</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>flux<span class="w"> </span>create<span class="w"> </span>alert-provider<span class="w"> </span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">  </span>--type<span class="o">=</span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">  </span>--secret-ref<span class="o">=</span>discord-webhook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">  </span>--channel<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">  </span>--username<span class="o">=</span>FluxCD<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>./apps/agnhost/discord.notification-provider.yaml
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>flux<span class="w"> </span>create<span class="w"> </span>alert-provider<span class="w"> </span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">  </span>--type<span class="o">=</span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="w">  </span>--secret-ref<span class="o">=</span>discord-webhook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="w">  </span>--channel<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="w">  </span>--username<span class="o">=</span>FluxCD<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>./apps/podinfo/discord.notification-provider.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>---
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>apiVersion:<span class="w"> </span>notification.toolkit.fluxcd.io/v1beta3
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>kind:<span class="w"> </span>Provider
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>metadata:
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">  </span>name:<span class="w"> </span>discord
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>spec:
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">  </span>channel:<span class="w"> </span>agnhost
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">  </span>secretRef:
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">    </span>name:<span class="w"> </span>discord-webhook
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">  </span>type:<span class="w"> </span>discord
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">  </span>username:<span class="w"> </span>FluxCD
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>---
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>apiVersion:<span class="w"> </span>notification.toolkit.fluxcd.io/v1beta3
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>kind:<span class="w"> </span>Provider
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>metadata:
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">  </span>name:<span class="w"> </span>discord
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>spec:
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">  </span>channel:<span class="w"> </span>podinfo
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">  </span>secretRef:
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span>name:<span class="w"> </span>discord-webhook
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">  </span>type:<span class="w"> </span>discord
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">  </span>username:<span class="w"> </span>FluxCD
</span></code></pre></div>
<p>```</p>
</div>
</div>
</div>
<h3 id="configuration-des-alertes">Configuration des alertes</h3>
<div class="tabbed-set tabbed-alternate" data-tabs="39:3"><input checked="checked" id="__tabbed_39_1" name="__tabbed_39" type="radio" /><input id="__tabbed_39_2" name="__tabbed_39" type="radio" /><input id="__tabbed_39_3" name="__tabbed_39" type="radio" /><div class="tabbed-labels"><label for="__tabbed_39_1">code</label><label for="__tabbed_39_2">agnhost</label><label for="__tabbed_39_3">podinfo</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>flux<span class="w"> </span>create<span class="w"> </span>alert<span class="w"> </span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">  </span>--event-severity<span class="o">=</span>info<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">  </span>--event-source<span class="o">=</span><span class="s1">&#39;GitRepository/*,Kustomization/*,ImageRepository/*,ImagePolicy/*,HelmRepository/*,HelmRelease/*&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">  </span>--provider-ref<span class="o">=</span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">  </span>--namespace<span class="o">=</span>agnhost<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/agnhost/discord.alert.yaml
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>flux<span class="w"> </span>create<span class="w"> </span>alert<span class="w"> </span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="w">  </span>--event-severity<span class="o">=</span>info<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="w">  </span>--event-source<span class="o">=</span><span class="s1">&#39;GitRepository/*,Kustomization/*,ImageRepository/*,ImagePolicy/*,HelmRepository/*,HelmRelease/*&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="w">  </span>--provider-ref<span class="o">=</span>discord<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>apps/podinfo/discord.alert.yaml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>---
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>apiVersion:<span class="w"> </span>notification.toolkit.fluxcd.io/v1beta3
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>kind:<span class="w"> </span>Alert
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>metadata:
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">  </span>name:<span class="w"> </span>discord
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">  </span>namespace:<span class="w"> </span>agnhost
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a>spec:
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">  </span>eventSeverity:<span class="w"> </span>info
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">  </span>eventSources:
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>GitRepository
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>Kustomization
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ImageRepository
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ImagePolicy
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>HelmRepository
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>HelmRelease
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a><span class="w">  </span>providerRef:
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="w">    </span>name:<span class="w"> </span>discord
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>---
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>apiVersion:<span class="w"> </span>notification.toolkit.fluxcd.io/v1beta3
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>kind:<span class="w"> </span>Alert
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>metadata:
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">  </span>name:<span class="w"> </span>discord
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>spec:
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">  </span>eventSeverity:<span class="w"> </span>info
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">  </span>eventSources:
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>GitRepository
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>Kustomization
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ImageRepository
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ImagePolicy
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>HelmRepository
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>HelmRelease
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="w">    </span>name:<span class="w"> </span><span class="s1">&#39;*&#39;</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a><span class="w">  </span>providerRef:
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a><span class="w">    </span>name:<span class="w"> </span>discord
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="activation-des-alertes-et-notifications">Activation des alertes et notifications</h3>
<p>Poussons nos modifications dans notre dÃ©pÃ´t GitHub :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;&#39;Setting up Discord alerting for agnhost and podinfo applications.&quot;</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>git<span class="w"> </span>push
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>VÃ©rifions la bonne crÃ©ation des alertes et notification providers :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="40:2"><input checked="checked" id="__tabbed_40_1" name="__tabbed_40" type="radio" /><input id="__tabbed_40_2" name="__tabbed_40" type="radio" /><div class="tabbed-labels"><label for="__tabbed_40_1">code</label><label for="__tabbed_40_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>providers,alerts<span class="w"> </span>-A
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>NAMESPACE<span class="w">   </span>NAME<span class="w">                                              </span>AGE
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>agnhost<span class="w">     </span>provider.notification.toolkit.fluxcd.io/discord<span class="w">   </span>27s
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>podinfo<span class="w">     </span>provider.notification.toolkit.fluxcd.io/discord<span class="w">   </span>27s
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>NAMESPACE<span class="w">   </span>NAME<span class="w">                                           </span>AGE
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>agnhost<span class="w">     </span>alert.notification.toolkit.fluxcd.io/discord<span class="w">   </span>27s
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>podinfo<span class="w">     </span>alert.notification.toolkit.fluxcd.io/discord<span class="w">   </span>27s
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="tests">Tests</h3>
<h4 id="application-agnhost">Application '<em>agnhost</em>'</h4>
<h5 id="contexte">Contexte</h5>
<p>Pour rappel, l'application '<em>agnhost</em>' est dÃ©ployÃ©e sur notre cluster Kubernetes Ã  la version <code>2.10</code> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="41:2"><input checked="checked" id="__tabbed_41_1" name="__tabbed_41" type="radio" /><input id="__tabbed_41_2" name="__tabbed_41" type="radio" /><div class="tabbed-labels"><label for="__tabbed_41_1">code</label><label for="__tabbed_41_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>agnhost<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.template.spec.containers[].image}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>registry.k8s.io/e2e-test-images/agnhost:2.10%
</span></code></pre></div>
</div>
</div>
</div>
<p>L'<em>ImageRepository</em> propose pourtant des images beaucoup rÃ©centes de l'application :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="42:2"><input checked="checked" id="__tabbed_42_1" name="__tabbed_42" type="radio" /><input id="__tabbed_42_2" name="__tabbed_42" type="radio" /><div class="tabbed-labels"><label for="__tabbed_42_1">code</label><label for="__tabbed_42_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>imagerepository<span class="w"> </span>agnhost<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.lastScanResult.latestTags}&#39;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="o">[</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">  </span><span class="s2">&quot;2.9&quot;</span>,
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">  </span><span class="s2">&quot;2.57&quot;</span>,
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">  </span><span class="s2">&quot;2.56&quot;</span>,
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">  </span><span class="s2">&quot;2.55&quot;</span>,
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span><span class="s2">&quot;2.54&quot;</span>,
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">  </span><span class="s2">&quot;2.53&quot;</span>,
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">  </span><span class="s2">&quot;2.52&quot;</span>,
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">  </span><span class="s2">&quot;2.51&quot;</span>,
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">  </span><span class="s2">&quot;2.50&quot;</span>,
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">  </span><span class="s2">&quot;2.48&quot;</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="o">]</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>L'<em>ImagePolicy</em> que nous avons mise en place nous en donne la raison :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="43:2"><input checked="checked" id="__tabbed_43_1" name="__tabbed_43" type="radio" /><input id="__tabbed_43_2" name="__tabbed_43" type="radio" /><div class="tabbed-labels"><label for="__tabbed_43_1">code</label><label for="__tabbed_43_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>imagepolicy<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[].spec.policy}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="o">{</span><span class="s2">&quot;numerical&quot;</span>:<span class="o">{</span><span class="s2">&quot;order&quot;</span>:<span class="s2">&quot;desc&quot;</span><span class="o">}}</span>%
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous avons expressÃ©ment demandÃ© Ã  Flux qu'il choisisse le tag (au format 'x.yz') le plus petit ('<em>order: desc</em>').</p>
<h5 id="test">Test</h5>
<p>Modifions notre <em>ImagePolicy</em> de sorte qu'il choisisse dÃ©sormais l'image au tag numÃ©riquement le plus Ã©levÃ© (pour ne pas dire l'image la plus rÃ©cente) et forÃ§ons la rÃ©conciliation :</p>
<div class="language-text highlight"><pre><span></span><code>export LOCAL_GITHUB_REPOS=&quot;${HOME}/code/github&quot;

cd ${LOCAL_GITHUB_REPOS}/k8s-kind-fluxcd

gsed -i &#39;s/order: desc/order: asc/&#39; apps/foo/agnhost.imagepolicy.yaml

git add .
git commit -m &quot;Modifying &#39;agnhost&#39; image policy to get the latest image.&quot;
git push

flux reconcile kustomization flux-system --with-source
```
</code></pre></div>
<p>Surveillons nos pods pendant la rÃ©conciliation :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="44:2"><input checked="checked" id="__tabbed_44_1" name="__tabbed_44" type="radio" /><input id="__tabbed_44_2" name="__tabbed_44" type="radio" /><div class="tabbed-labels"><label for="__tabbed_44_1">code</label><label for="__tabbed_44_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>agnhost<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-w
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>NAME<span class="w">                       </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>agnhost-7cd476ffd6-l7v4m<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>12m
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a>agnhost-86d684f6bf-qsccn<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a>agnhost-86d684f6bf-qsccn<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>agnhost-86d684f6bf-qsccn<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>ContainerCreating<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a>agnhost-86d684f6bf-qsccn<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">          </span>1s
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a>agnhost-7cd476ffd6-l7v4m<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>14m
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a>agnhost-7cd476ffd6-l7v4m<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">0</span><span class="w">          </span>14m
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a>agnhost-7cd476ffd6-l7v4m<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">0</span><span class="w">          </span>14m
</span><span id="__span-101-10"><a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a>agnhost-7cd476ffd6-l7v4m<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">0</span><span class="w">          </span>14m
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous voyons le pod 'agnhost-7cd476ffd6-l7v4m' se faire remplacer par un nouveau pod 'agnhost-7cd476ffd6-l7v4m'.</p>
<p>Pendant l'opÃ©ration, le client <em>Discord</em> sonne et affiche des alertes :</p>
<p><img alt="Discord alerting for 'agnhost' app" src="../images/discord_alerting_agnhost.png" /></p>
<h4 id="application-podinfo">Application '<em>podinfo</em>'</h4>
<h5 id="contexte_1">Contexte</h5>
<p>L'application '<em>podinfo</em>' est dÃ©ployÃ©e Ã  la version <code>5.2.1</code> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="45:2"><input checked="checked" id="__tabbed_45_1" name="__tabbed_45" type="radio" /><input id="__tabbed_45_2" name="__tabbed_45" type="radio" /><div class="tabbed-labels"><label for="__tabbed_45_1">code</label><label for="__tabbed_45_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>helmrelease<span class="w"> </span>podinfo
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>NAME<span class="w">      </span>AGE<span class="w">     </span>READY<span class="w">   </span>STATUS
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>podinfo<span class="w">   </span>6h42m<span class="w">   </span>True<span class="w">    </span>Helm<span class="w"> </span>upgrade<span class="w"> </span>succeeded<span class="w"> </span><span class="k">for</span><span class="w"> </span>release<span class="w"> </span>podinfo/podinfo.v3<span class="w"> </span>with<span class="w"> </span>chart<span class="w"> </span>podinfo@5.2.1
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous savons qu'il ne s'agit pas de la version la plus rÃ©cente :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="46:2"><input checked="checked" id="__tabbed_46_1" name="__tabbed_46" type="radio" /><input id="__tabbed_46_2" name="__tabbed_46" type="radio" /><div class="tabbed-labels"><label for="__tabbed_46_1">code</label><label for="__tabbed_46_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>papaFrancky
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;my_github_personal_access_token&gt;
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_TOKEN</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>login<span class="w"> </span>ghcr.io<span class="w"> </span>-u<span class="w"> </span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span>--password-stdin
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>helm<span class="w"> </span>show<span class="w"> </span>chart<span class="w"> </span>oci://ghcr.io/stefanprodan/charts/podinfo
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>Pulled:<span class="w"> </span>ghcr.io/stefanprodan/charts/podinfo:6.9.2
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>Digest:<span class="w"> </span>sha256:971fef0d04d5b3d03d035701dad59411ea0f60e28d16190f02469ddfe5587588
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>apiVersion:<span class="w"> </span>v1
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>appVersion:<span class="w"> </span><span class="m">6</span>.9.2
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>description:<span class="w"> </span>Podinfo<span class="w"> </span>Helm<span class="w"> </span>chart<span class="w"> </span><span class="k">for</span><span class="w"> </span>Kubernetes
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>home:<span class="w"> </span>https://github.com/stefanprodan/podinfo
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a>kubeVersion:<span class="w"> </span><span class="s1">&#39;&gt;=1.23.0-0&#39;</span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a>maintainers:
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a>-<span class="w"> </span>email:<span class="w"> </span>stefanprodan@users.noreply.github.com
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="w">  </span>name:<span class="w"> </span>stefanprodan
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a>name:<span class="w"> </span>podinfo
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a>sources:
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a>-<span class="w"> </span>https://github.com/stefanprodan/podinfo
</span><span id="__span-105-14"><a id="__codelineno-105-14" name="__codelineno-105-14" href="#__codelineno-105-14"></a>version:<span class="w"> </span><span class="m">6</span>.9.2
</span></code></pre></div>
</div>
</div>
</div>
<p>La version la plus rÃ©cente de '<em>podinfo</em>' est taguÃ©e <code>6.9.2</code></p>
<p>Nous avions prÃ©cisÃ© dans la dÃ©finition de la <em>HelmRelease</em> que nous ne voulions pas de versions &gt;= 6.0.0 :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="47:2"><input checked="checked" id="__tabbed_47_1" name="__tabbed_47" type="radio" /><input id="__tabbed_47_2" name="__tabbed_47" type="radio" /><div class="tabbed-labels"><label for="__tabbed_47_1">code</label><label for="__tabbed_47_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>helmrelease<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[].spec.chart.spec.version}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>&lt;<span class="m">6</span>.0.0%
</span></code></pre></div>
</div>
</div>
</div>
<h5 id="test_1">Test</h5>
<div class="tabbed-set tabbed-alternate" data-tabs="48:1"><input checked="checked" id="__tabbed_48_1" name="__tabbed_48" type="radio" /><div class="tabbed-labels"><label for="__tabbed_48_1">code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a>gsed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/version: &lt;6.0.0/version: \&#39;\*\&#39;/&quot;</span><span class="w"> </span>podinfo/podinfo.helmrelease.yaml
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Modified podinfo HelmRelease to get the latest app version.&#39;</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a>git<span class="w"> </span>push
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a>flux<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>podinfo<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
</div>
</div>
<p>Surveillons les pods de l'application pendant la rÃ©concliation :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="49:2"><input checked="checked" id="__tabbed_49_1" name="__tabbed_49" type="radio" /><input id="__tabbed_49_2" name="__tabbed_49" type="radio" /><div class="tabbed-labels"><label for="__tabbed_49_1">code</label><label for="__tabbed_49_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-w
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>NAME<span class="w">                     </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">       </span>AGE
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>podinfo-84865fdc-hfdsp<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>122m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h28m
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>podinfo-84865fdc-s9vnq<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>122m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h28m
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>podinfo-db75857bd-vdl6k<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">   </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>podinfo-84865fdc-hfdsp<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Terminating<span class="w">   </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>podinfo-db75857bd-vdl6k<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">       </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>podinfo-db75857bd-vdl6k<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>ContainerCreating<span class="w">   </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>podinfo-db75857bd-9c6pq<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">             </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>podinfo-db75857bd-9c6pq<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">             </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a>podinfo-db75857bd-9c6pq<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>ContainerCreating<span class="w">   </span><span class="m">0</span><span class="w">              </span>0s
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a>podinfo-db75857bd-vdl6k<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">              </span>2s
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>podinfo-db75857bd-9c6pq<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">              </span>3s
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a>podinfo-db75857bd-vdl6k<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">              </span>3s
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a>podinfo-84865fdc-s9vnq<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a>podinfo-84865fdc-hfdsp<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a>podinfo-84865fdc-hfdsp<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a>podinfo-84865fdc-hfdsp<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-18"><a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a>podinfo-db75857bd-9c6pq<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">              </span>4s
</span><span id="__span-110-19"><a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a>podinfo-84865fdc-s9vnq<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-20"><a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a>podinfo-84865fdc-s9vnq<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span><span id="__span-110-21"><a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a>podinfo-84865fdc-s9vnq<span class="w">    </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>124m<span class="w"> </span>ago<span class="o">)</span><span class="w">   </span>5h31m
</span></code></pre></div>
</div>
</div>
</div>
<p>Les pods <code>podinfo-84865fdc-hfdsp</code> et <code>podinfo-84865fdc-s9vnq</code> sont remplacÃ©s par deux nouveaux pods <code>podinfo-db75857bd-vdl6k</code> et <code>podinfo-db75857bd-vdl6k</code>.</p>
<p>VÃ©rifions la version de notre application maintenant : </p>
<div class="tabbed-set tabbed-alternate" data-tabs="50:2"><input checked="checked" id="__tabbed_50_1" name="__tabbed_50" type="radio" /><input id="__tabbed_50_2" name="__tabbed_50" type="radio" /><div class="tabbed-labels"><label for="__tabbed_50_1">code</label><label for="__tabbed_50_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>podinfo<span class="w"> </span>get<span class="w"> </span>helmrelease<span class="w"> </span>podinfo
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>NAME<span class="w">      </span>AGE<span class="w">     </span>READY<span class="w">   </span>STATUS
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>podinfo<span class="w">   </span>7h18m<span class="w">   </span>True<span class="w">    </span>Helm<span class="w"> </span>upgrade<span class="w"> </span>succeeded<span class="w"> </span><span class="k">for</span><span class="w"> </span>release<span class="w"> </span>podinfo/podinfo.v4<span class="w"> </span>with<span class="w"> </span>chart<span class="w"> </span>podinfo@6.9.2
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous sommes dÃ©sormais bien Ã  la version <code>6.9.2</code> de l'application '<em>podinfo</em>', soit la plus rÃ©cente.</p>
<p>XXXXX</p>
<p>Testons leur bon fonctionnement : nous allons dÃ©sacmodifier l'<em><em>'Image Policy'</em></em> de l'application '<em>foo</em>' de sorte qu'elle installent la version la plus ancienne des images et non plus la plus rÃ©cente :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="51:2"><input checked="checked" id="__tabbed_51_1" name="__tabbed_51" type="radio" /><input id="__tabbed_51_2" name="__tabbed_51" type="radio" /><div class="tabbed-labels"><label for="__tabbed_51_1">code</label><label for="__tabbed_51_2">'foo' image policy</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>gsed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/order: asc/order: desc/&#39;</span><span class="w"> </span>apps/agnhost/agnhost.imagepolicy.yaml
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Modifying &#39;foo&#39; image policy for testing purpose.&quot;</span>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a>git<span class="w"> </span>push
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>---
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>apiVersion:<span class="w"> </span>image.toolkit.fluxcd.io/v1beta2
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>kind:<span class="w"> </span>ImagePolicy
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>metadata:
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">  </span>name:<span class="w"> </span>agnhost
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">  </span>namespace:<span class="w"> </span>foo
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>spec:
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="w">  </span>filterTags:
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">    </span>extract:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">    </span>pattern:<span class="w"> </span><span class="m">2</span><span class="se">\.\d\d</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">  </span>imageRepositoryRef:
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">    </span>name:<span class="w"> </span>agnhost
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">  </span>policy:
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">    </span>numerical:
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="w">      </span>order:<span class="w"> </span>desc
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous recevons les notifications suivantes dans la <em>room</em> '#foo' :</p>
<p><img alt="Discord alerting for 'foo' app" src="images/discord_alerting_foo.png" /></p>
<div class="tabbed-set tabbed-alternate" data-tabs="52:2"><input checked="checked" id="__tabbed_52_1" name="__tabbed_52" type="radio" /><input id="__tabbed_52_2" name="__tabbed_52" type="radio" /><div class="tabbed-labels"><label for="__tabbed_52_1">code</label><label for="__tabbed_52_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>foo<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>foo<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.template.spec.containers[].image}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>registry.k8s.io/e2e-test-images/agnhost:2.10
</span></code></pre></div>
</div>
</div>
</div>
<p>FluxCD a rÃ©Ã©crit le manifest dÃ©finissant le '<em>deployment</em>' de l'application '<em>foo</em>' pour passer le tag de l'image utilisÃ©e de 2.57 Ã  2.10.</p>
<p>Pour constater ce changement sur notre copie locale, nous devons la mettre Ã  jour depuis le dÃ©pÃ´t GitHub :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="53:2"><input checked="checked" id="__tabbed_53_1" name="__tabbed_53" type="radio" /><input id="__tabbed_53_2" name="__tabbed_53" type="radio" /><div class="tabbed-labels"><label for="__tabbed_53_1">code</label><label for="__tabbed_53_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>git<span class="w"> </span>pull
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a>cat<span class="w"> </span>foo/deployment.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>image
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="w">        </span>image:<span class="w"> </span>registry.k8s.io/e2e-test-images/agnhost:2.10<span class="w"> </span><span class="c1"># {&quot;$imagepolicy&quot;: &quot;foo:agnhost&quot;}</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>L'image utilisÃ©e est dÃ©sormais passÃ©e Ã  la version 2.10.</p>
<p>Testons Ã©galement les notifications pour une application packagÃ©e avec Helm : '<em>podinfo</em>'. CommenÃ§ons par rÃ©cupÃ©rer la version du Helm Chart dÃ©ployÃ© par la Helm Release :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="54:2"><input checked="checked" id="__tabbed_54_1" name="__tabbed_54" type="radio" /><input id="__tabbed_54_2" name="__tabbed_54" type="radio" /><div class="tabbed-labels"><label for="__tabbed_54_1">code</label><label for="__tabbed_54_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>helmrelease<span class="w"> </span>podinfo<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.history[].chartVersion}&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="m">6</span>.9.2
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous allons modifier la dÃ©finition de notre HelmRelease pour qu'elle soit dÃ©ployÃ©e Ã  partir d'un Helm Chart d'une version majeure infÃ©rieure Ã  6 :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="55:2"><input checked="checked" id="__tabbed_55_1" name="__tabbed_55" type="radio" /><input id="__tabbed_55_2" name="__tabbed_55" type="radio" /><div class="tabbed-labels"><label for="__tabbed_55_1">code</label><label for="__tabbed_55_2">podinfo HelmRelease</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-apps
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>flux<span class="w"> </span>create<span class="w"> </span>helmrelease<span class="w"> </span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">  </span>--namespace<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="w">  </span>--source<span class="o">=</span>HelmRepository/podinfo.podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="w">  </span>--chart<span class="o">=</span>podinfo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">  </span>--chart-version<span class="o">=</span><span class="s2">&quot;&lt;6.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="w">  </span>--values-from<span class="o">=</span>ConfigMap/podinfo-values<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-11"><a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="w">  </span>--interval<span class="o">=</span>10m<span class="w"> </span><span class="se">\</span>
</span><span id="__span-121-12"><a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">  </span>--export<span class="w"> </span>&gt;<span class="w"> </span>podinfo/podinfo.helmrelease.yaml
</span><span id="__span-121-13"><a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a>
</span><span id="__span-121-14"><a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-121-15"><a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Modified podinfo HelmRelease to use a Chart version &lt; 6.&#39;</span>
</span><span id="__span-121-16"><a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a>git<span class="w"> </span>push
</span><span id="__span-121-17"><a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a>
</span><span id="__span-121-18"><a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>---
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>apiVersion:<span class="w"> </span>helm.toolkit.fluxcd.io/v2
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a>kind:<span class="w"> </span>HelmRelease
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a>metadata:
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">  </span>name:<span class="w"> </span>podinfo
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">  </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a>spec:
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">  </span>chart:
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span>spec:
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">      </span>chart:<span class="w"> </span>podinfo
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">      </span>reconcileStrategy:<span class="w"> </span>ChartVersion
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">      </span>sourceRef:
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">        </span>kind:<span class="w"> </span>HelmRepository
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">        </span>name:<span class="w"> </span>podinfo
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="w">        </span>namespace:<span class="w"> </span>podinfo
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="w">  </span>interval:<span class="w"> </span>1m0s
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">  </span>valuesFrom:
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="w">  </span>-<span class="w"> </span>kind:<span class="w"> </span>ConfigMap
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="w">    </span>name:<span class="w"> </span>podinfo-values
</span></code></pre></div>
</div>
</div>
</div>
<p>Poussons nos modifications sur notre dÃ©pÃ´t GitHub et forÃ§ons la rÃ©conciliation Flux :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Defined podinfo HelmRelease with custom values as a ConfigMap.&#39;</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>git<span class="w"> </span>push
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<h3 id="rollback">Rollback</h3>
<p>Le test est concluant, revenons Ã  la situation initiale oÃ¹ FluxCD s'assure de dÃ©ployer la version la plus rÃ©cente de l'image Docker.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="56:1"><input checked="checked" id="__tabbed_56_1" name="__tabbed_56" type="radio" /><div class="tabbed-labels"><label for="__tabbed_56_1">code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a>gsed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/order: desc/order: asc/&#39;</span><span class="w"> </span>apps/foo/agnhost.imagepolicy.yaml
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a>gsed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/order: desc/order: asc/&#39;</span><span class="w"> </span>apps/bar/agnhost.imagepolicy.yaml
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;test: rollback to normal.&quot;</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a>git<span class="w"> </span>push
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
</div>
</div>
</div>
<p>Discord nous informe directement des modifications apportÃ©es Ã  nos applications :</p>
<p><img alt="Discord alerting for 'foo' rollback operation" src="../images/discord_alerting_foo_rollback.png" /></p>
<p><img alt="Discord alerting for 'bar' rollback operation" src="../images/discord_alerting_bar_rollback.png" /></p>
<p>Juste avant de pousser les modifications sur notre dÃ©pÃ´t GitHub et de forcer la rÃ©conciliation Flux, nous avions exÃ©cutÃ© la commande suivante dans un terminal pour surveiller le cycle de vie des pods concernÃ©s :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="57:2"><input checked="checked" id="__tabbed_57_1" name="__tabbed_57" type="radio" /><input id="__tabbed_57_2" name="__tabbed_57" type="radio" /><div class="tabbed-labels"><label for="__tabbed_57_1">code</label><label for="__tabbed_57_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces<span class="w"> </span>-l<span class="w"> </span><span class="s1">&#39;app in (foo, bar)&#39;</span><span class="w"> </span>-w
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>NAMESPACE<span class="w">   </span>NAME<span class="w">                   </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>25m
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>25m
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a>foo<span class="w">         </span>foo-6b7d6f775c-fhtdj<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a>foo<span class="w">         </span>foo-6b7d6f775c-fhtdj<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a>foo<span class="w">         </span>foo-6b7d6f775c-fhtdj<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>ContainerCreating<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a>foo<span class="w">         </span>foo-6b7d6f775c-fhtdj<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">          </span>1s
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a>foo<span class="w">         </span>foo-774bffc7f5-r7q6g<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a>bar<span class="w">         </span>bar-76848b7788-zc6r2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">             </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a>bar<span class="w">         </span>bar-76848b7788-zc6r2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Pending<span class="w">             </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-15"><a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a>bar<span class="w">         </span>bar-76848b7788-zc6r2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>ContainerCreating<span class="w">   </span><span class="m">0</span><span class="w">          </span>0s
</span><span id="__span-126-16"><a id="__codelineno-126-16" name="__codelineno-126-16" href="#__codelineno-126-16"></a>bar<span class="w">         </span>bar-76848b7788-zc6r2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">             </span><span class="m">0</span><span class="w">          </span>1s
</span><span id="__span-126-17"><a id="__codelineno-126-17" name="__codelineno-126-17" href="#__codelineno-126-17"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-18"><a id="__codelineno-126-18" name="__codelineno-126-18" href="#__codelineno-126-18"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-19"><a id="__codelineno-126-19" name="__codelineno-126-19" href="#__codelineno-126-19"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-20"><a id="__codelineno-126-20" name="__codelineno-126-20" href="#__codelineno-126-20"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span><span id="__span-126-21"><a id="__codelineno-126-21" name="__codelineno-126-21" href="#__codelineno-126-21"></a>bar<span class="w">         </span>bar-5f6dc76fcd-xrtk2<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Terminating<span class="w">         </span><span class="m">0</span><span class="w">          </span>27m
</span></code></pre></div>
</div>
</div>
</div>
<p>Nous constatons que pour 'foo' comme pour 'bar', un nouveau pod est crÃ©Ã© et une fois opÃ©rationnel, le pod qu'il remplace est supprimÃ©.</p>
<p>Le version des images correspond Ã  nouveau la plus rÃ©cente des versions proposÃ©es :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="58:2"><input checked="checked" id="__tabbed_58_1" name="__tabbed_58" type="radio" /><input id="__tabbed_58_2" name="__tabbed_58" type="radio" /><div class="tabbed-labels"><label for="__tabbed_58_1">code</label><label for="__tabbed_58_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;foo - &quot;</span><span class="p">;</span>kubectl<span class="w"> </span>-n<span class="w"> </span>foo<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.items[].spec.containers[].image&#39;</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;bar - &quot;</span><span class="p">;</span>kubectl<span class="w"> </span>-n<span class="w"> </span>bar<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.items[].spec.containers[].image&#39;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p><code>sh
foo - registry.k8s.io/e2e-test-images/agnhost:2.52
bar - registry.k8s.io/e2e-test-images/agnhost:2.52</code></p>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il semblerait bien que pendant que nous rÃ©alisions nos tests de notifications Discord, la version 2.52 de l'image agnhost a Ã©tÃ© publiÃ©e.</p>
</div>
<p>VÃ©rifions Ã  nouveau la liste des versions proposÃ©es par le dÃ©pÃ´t des images 'agnhost' :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="59:2"><input checked="checked" id="__tabbed_59_1" name="__tabbed_59" type="radio" /><input id="__tabbed_59_2" name="__tabbed_59" type="radio" /><div class="tabbed-labels"><label for="__tabbed_59_1">code</label><label for="__tabbed_59_2">output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>foo<span class="w"> </span>get<span class="w"> </span>imagerepository<span class="w"> </span>agnhost<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.lastScanResult.latestTags}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="o">[</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="w">  </span><span class="s2">&quot;2.9&quot;</span>,
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">  </span><span class="s2">&quot;2.52&quot;</span>,
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">  </span><span class="s2">&quot;2.51&quot;</span>,
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="w">  </span><span class="s2">&quot;2.50&quot;</span>,
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="w">  </span><span class="s2">&quot;2.48&quot;</span>,
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="w">  </span><span class="s2">&quot;2.47&quot;</span>,
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="w">  </span><span class="s2">&quot;2.45&quot;</span>,
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="w">  </span><span class="s2">&quot;2.44&quot;</span>,
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="w">  </span><span class="s2">&quot;2.43&quot;</span>,
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="w">  </span><span class="s2">&quot;2.41&quot;</span>
</span><span id="__span-129-12"><a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="o">]</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Effectivement, nous voyons bien la version 2.52 apparaÃ®tre dÃ©sormais <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M464 256a208 208 0 1 0-416 0 208 208 0 1 0 416 0M0 256a256 256 0 1 1 512 0 256 256 0 1 1-512 0m118.3 58.2c-4.2-13.7 7.1-26.2 21.4-26.2h232.6c14.3 0 25.6 12.5 21.4 26.2C375.7 373.1 320.8 416 256 416s-119.7-42.9-137.7-101.8M144 192a32 32 0 1 1 64 0 32 32 0 1 1-64 0m164 8c0 11-9 20-20 20s-20-9-20-20c0-33.1 26.9-60 60-60h16c33.1 0 60 26.9 60 60 0 11-9 20-20 20s-20-9-20-20-9-20-20-20h-16c-11 0-20 9-20 20"/></svg></span></p>
<hr />
<p>TODO</p>
<ul>
<li>Faire le schÃ©ma en mermaid avec les imageupdateautomations, imagepolicies, imagerepositories, gitrepositories etc</li>
</ul>
<hr />
<h3 id="exposition-des-applications">Exposition des applications</h3>
<p>L'exposition des applications hÃ©bergÃ©es sur le cluster doit Ãªtre gÃ©rÃ©e en dehors des applications. Nous allons dÃ©finir les rÃ¨gles de routage de notre Ingress controller Nginx dans le dÃ©pÃ´t GitHub dÃ©diÃ© Ã  FluxCD :</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bien que le contrÃ´leur Ingress puisse Ãªtre dÃ©ployÃ© dans n'importe quel namespace, il est gÃ©nÃ©ralement dÃ©ployÃ© dans un namespace distinct de vos services d'application (par exemple, ingress ou kube-system). Il peut voir les rÃ¨gles Ingress dans tous les autres espaces de noms et les rÃ©cupÃ©rer. Cependant, chaque rÃ¨gle Ingress doit rÃ©sider dans l'espace de noms oÃ¹ rÃ©side l'application qu'elle configure.</p>
</div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/code/github&quot;</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">LOCAL_GITHUB_REPOS</span><span class="si">}</span>/k8s-kind-fluxcd
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt; apps/foo/ingress.yaml</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="s">---</span>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="s">apiVersion: networking.k8s.io/v1</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="s">kind: Ingress</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="s">metadata:</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="s">  name: foo</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="s">  namespace: foo</span>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a><span class="s">  annotations:</span>
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="s">    nginx.ingress.kubernetes.io/rewrite-target: /$2</span>
</span><span id="__span-130-14"><a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a><span class="s">spec:</span>
</span><span id="__span-130-15"><a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a><span class="s">  rules:</span>
</span><span id="__span-130-16"><a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a><span class="s">  - http:</span>
</span><span id="__span-130-17"><a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="s">      paths:</span>
</span><span id="__span-130-18"><a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a><span class="s">      - pathType: Prefix</span>
</span><span id="__span-130-19"><a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a><span class="s">        path: /foo(/|$)(.*)</span>
</span><span id="__span-130-20"><a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a><span class="s">        backend:</span>
</span><span id="__span-130-21"><a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a><span class="s">          service:</span>
</span><span id="__span-130-22"><a id="__codelineno-130-22" name="__codelineno-130-22" href="#__codelineno-130-22"></a><span class="s">            name: foo</span>
</span><span id="__span-130-23"><a id="__codelineno-130-23" name="__codelineno-130-23" href="#__codelineno-130-23"></a><span class="s">            port:</span>
</span><span id="__span-130-24"><a id="__codelineno-130-24" name="__codelineno-130-24" href="#__codelineno-130-24"></a><span class="s">              number: 8080</span>
</span><span id="__span-130-25"><a id="__codelineno-130-25" name="__codelineno-130-25" href="#__codelineno-130-25"></a><span class="s">EOF</span>
</span><span id="__span-130-26"><a id="__codelineno-130-26" name="__codelineno-130-26" href="#__codelineno-130-26"></a>
</span><span id="__span-130-27"><a id="__codelineno-130-27" name="__codelineno-130-27" href="#__codelineno-130-27"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt; apps/bar/ingress.yaml</span>
</span><span id="__span-130-28"><a id="__codelineno-130-28" name="__codelineno-130-28" href="#__codelineno-130-28"></a><span class="s">---</span>
</span><span id="__span-130-29"><a id="__codelineno-130-29" name="__codelineno-130-29" href="#__codelineno-130-29"></a><span class="s">apiVersion: networking.k8s.io/v1</span>
</span><span id="__span-130-30"><a id="__codelineno-130-30" name="__codelineno-130-30" href="#__codelineno-130-30"></a><span class="s">kind: Ingress</span>
</span><span id="__span-130-31"><a id="__codelineno-130-31" name="__codelineno-130-31" href="#__codelineno-130-31"></a><span class="s">metadata:</span>
</span><span id="__span-130-32"><a id="__codelineno-130-32" name="__codelineno-130-32" href="#__codelineno-130-32"></a><span class="s">  name: bar</span>
</span><span id="__span-130-33"><a id="__codelineno-130-33" name="__codelineno-130-33" href="#__codelineno-130-33"></a><span class="s">  namespace: bar</span>
</span><span id="__span-130-34"><a id="__codelineno-130-34" name="__codelineno-130-34" href="#__codelineno-130-34"></a><span class="s">  annotations:</span>
</span><span id="__span-130-35"><a id="__codelineno-130-35" name="__codelineno-130-35" href="#__codelineno-130-35"></a><span class="s">    nginx.ingress.kubernetes.io/rewrite-target: /$2</span>
</span><span id="__span-130-36"><a id="__codelineno-130-36" name="__codelineno-130-36" href="#__codelineno-130-36"></a><span class="s">spec:</span>
</span><span id="__span-130-37"><a id="__codelineno-130-37" name="__codelineno-130-37" href="#__codelineno-130-37"></a><span class="s">  rules:</span>
</span><span id="__span-130-38"><a id="__codelineno-130-38" name="__codelineno-130-38" href="#__codelineno-130-38"></a><span class="s">  - http:</span>
</span><span id="__span-130-39"><a id="__codelineno-130-39" name="__codelineno-130-39" href="#__codelineno-130-39"></a><span class="s">      paths:</span>
</span><span id="__span-130-40"><a id="__codelineno-130-40" name="__codelineno-130-40" href="#__codelineno-130-40"></a><span class="s">      - pathType: Prefix</span>
</span><span id="__span-130-41"><a id="__codelineno-130-41" name="__codelineno-130-41" href="#__codelineno-130-41"></a><span class="s">        path: /bar(/|$)(.*)</span>
</span><span id="__span-130-42"><a id="__codelineno-130-42" name="__codelineno-130-42" href="#__codelineno-130-42"></a><span class="s">        backend:</span>
</span><span id="__span-130-43"><a id="__codelineno-130-43" name="__codelineno-130-43" href="#__codelineno-130-43"></a><span class="s">          service:</span>
</span><span id="__span-130-44"><a id="__codelineno-130-44" name="__codelineno-130-44" href="#__codelineno-130-44"></a><span class="s">            name: bar</span>
</span><span id="__span-130-45"><a id="__codelineno-130-45" name="__codelineno-130-45" href="#__codelineno-130-45"></a><span class="s">            port:</span>
</span><span id="__span-130-46"><a id="__codelineno-130-46" name="__codelineno-130-46" href="#__codelineno-130-46"></a><span class="s">              number: 8080</span>
</span><span id="__span-130-47"><a id="__codelineno-130-47" name="__codelineno-130-47" href="#__codelineno-130-47"></a><span class="s">EOF</span>
</span><span id="__span-130-48"><a id="__codelineno-130-48" name="__codelineno-130-48" href="#__codelineno-130-48"></a>
</span><span id="__span-130-49"><a id="__codelineno-130-49" name="__codelineno-130-49" href="#__codelineno-130-49"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-130-50"><a id="__codelineno-130-50" name="__codelineno-130-50" href="#__codelineno-130-50"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: setting up Ingress routes for foo and bar.&quot;</span>
</span><span id="__span-130-51"><a id="__codelineno-130-51" name="__codelineno-130-51" href="#__codelineno-130-51"></a>git<span class="w"> </span>push
</span><span id="__span-130-52"><a id="__codelineno-130-52" name="__codelineno-130-52" href="#__codelineno-130-52"></a>
</span><span id="__span-130-53"><a id="__codelineno-130-53" name="__codelineno-130-53" href="#__codelineno-130-53"></a>flux<span class="w"> </span>reconcile<span class="w"> </span>kustomization<span class="w"> </span>flux-system<span class="w"> </span>--with-source
</span></code></pre></div>
<p>Testons le bon fonctionnement de nos routes :</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>curl<span class="w"> </span>http://localhost/foo<span class="w">           </span><span class="c1"># -&gt; NOW: 2024-04-27 18:14:24.152568822 +0000 UTC m=+5403.294573418%</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>curl<span class="w"> </span>http://localhost/foo/hostname<span class="w">  </span><span class="c1"># -&gt; foo-9d658c7db-x6v84%</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>curl<span class="w"> </span>http://localhost/bar<span class="w">           </span><span class="c1"># -&gt; NOW: 2024-04-27 18:14:26.677481395 +0000 UTC m=+5108.710059928%</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a>curl<span class="w"> </span>http://localhost/bar/hostname<span class="w">  </span><span class="c1"># -&gt; bar-5c7c6495ff-954bh%</span>
</span></code></pre></div>
<p>Le routage fonctionne comme attendu ! <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M464 256a208 208 0 1 0-416 0 208 208 0 1 0 416 0M0 256a256 256 0 1 1 512 0 256 256 0 1 1-512 0m118.3 58.2c-4.2-13.7 7.1-26.2 21.4-26.2h232.6c14.3 0 25.6 12.5 21.4 26.2C375.7 373.1 320.8 416 256 416s-119.7-42.9-137.7-101.8M144 192a32 32 0 1 1 64 0 32 32 0 1 1-64 0m164 8c0 11-9 20-20 20s-20-9-20-20c0-33.1 26.9-60 60-60h16c33.1 0 60 26.9 60 60 0 11-9 20-20 20s-20-9-20-20-9-20-20-20h-16c-11 0-20 9-20 20"/></svg></span></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>